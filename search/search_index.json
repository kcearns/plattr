{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Plattr","text":"<p>Alpha software \u2014 This project is under active development and not yet production-ready. APIs, configuration formats, and behavior may change without notice.</p> <p>An internal developer platform that gives teams a Vercel-like experience on top of Kubernetes. Define your app in a <code>plattr.yaml</code>, run <code>plattr dev</code> locally, push to deploy.</p> <p>Plattr handles databases, object storage, authentication, Redis, OpenSearch, auto-generated REST APIs, preview environments, and production deployment.</p>"},{"location":"#what-you-get","title":"What You Get","text":"Capability Local (<code>plattr dev</code>) Production (EKS) Infrastructure Kind cluster with port-forwards EKS with Ingress + TLS PostgreSQL Pod on :5432 Aurora (provisioned per-app schema) Object storage MinIO on :9000 S3 buckets Auth (Keycloak) Dev instance on :8080 Managed Keycloak on EKS Redis Pod on :6379 Managed Redis OpenSearch Pod on :9200, Dashboards on :5601 Managed OpenSearch REST API (PostgREST) Auto-generated on :3001 Sidecar in app pod, routed via <code>/api/rest</code> Local deploy <code>plattr deploy local</code> (test, build, scan, deploy) CI/CD via GitHub Actions Preview environments <code>plattr preview start --pr 42</code> Auto-created from PRs, TTL-based cleanup"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Start local infrastructure\nplattr dev\n\n# Source env vars and start your dev server\nsource .plattr/{appName}.env\nnpx next dev\n\n# Build, scan, and deploy to local Kind cluster\nplattr deploy local\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Tutorial \u2014 End-to-end walkthrough: set up a cluster, build and deploy an app</li> <li>Developer Guide \u2014 Building apps, local dev, deploying</li> <li>Plattr Team Guide \u2014 Infrastructure, operations, troubleshooting</li> <li>Reference<ul> <li>Architecture</li> <li>CLI</li> <li>CRDs</li> <li>plattr.yaml</li> </ul> </li> </ul>"},{"location":"developer-guide/","title":"Developer Guide","text":"<p>This guide walks you through building, running, and deploying apps on Plattr. By the end, you'll have a full-stack app with a database, object storage, authentication, and an auto-generated REST API \u2014 all from a single <code>plattr.yaml</code> file.</p>"},{"location":"developer-guide/#prerequisites","title":"Prerequisites","text":"<ul> <li>Node.js 18+ and npm</li> <li>Docker (Docker Desktop or colima)</li> <li>Kind \u2014 <code>go install sigs.k8s.io/kind@latest</code> or <code>brew install kind</code></li> <li>kubectl \u2014 <code>brew install kubectl</code> or install guide</li> <li>Dagger CLI \u2014 <code>curl -fsSL https://dl.dagger.io/dagger/install.sh | sh</code></li> <li>Plattr CLI \u2014 <code>npm install -g @plattr/cli</code></li> </ul>"},{"location":"developer-guide/#creating-a-new-app","title":"Creating a New App","text":"<pre><code>mkdir my-app &amp;&amp; cd my-app\nplattr init\n</code></pre> <p>The interactive wizard asks: 1. App name \u2014 lowercase, alphanumeric, hyphens allowed (e.g., <code>my-app</code>) 2. Framework \u2014 auto-detected, or choose: <code>nextjs</code>, <code>rails</code>, <code>static</code>, <code>docker</code> 3. Database \u2014 enable PostgreSQL? 4. Storage \u2014 enable S3-compatible object storage? 5. Auth \u2014 enable Keycloak authentication? 6. Redis \u2014 enable Redis cache? 7. OpenSearch \u2014 enable OpenSearch?</p> <p>This creates two files: - <code>plattr.yaml</code> \u2014 your app configuration - <code>.github/workflows/plattr-deploy.yml</code> \u2014 CI/CD pipeline</p>"},{"location":"developer-guide/#example-plattryaml","title":"Example <code>plattr.yaml</code>","text":"<pre><code>name: my-app\nframework: nextjs\n\ndatabase:\n  enabled: true\n\nstorage:\n  enabled: true\n  buckets:\n    - name: uploads\n      public: false\n    - name: assets\n      public: true\n\nauth:\n  enabled: true\n  providers:\n    - google\n    - github\n\nredis:\n  enabled: true\n\nsearch:\n  enabled: true\n\nlocal:\n  port: 3000\n</code></pre> <p>See the full plattr.yaml Reference for all options.</p>"},{"location":"developer-guide/#local-development","title":"Local Development","text":"<pre><code>plattr dev\n</code></pre> <p>This sets up your entire infrastructure stack locally on a Kind (Kubernetes in Docker) cluster:</p> <ol> <li>Creates a Kind cluster and local container registry (first run only)</li> <li>Deploys infrastructure services as Kubernetes pods</li> <li>Starts port-forwards so services are accessible on localhost</li> <li>Writes environment variables to <code>.plattr/{appName}.env</code></li> </ol> <p>After <code>plattr dev</code> completes, source the env file and start your dev server:</p> <pre><code>source .plattr/my-app.env\nnpx next dev          # Next.js\nbin/rails server      # Rails\nnpm run dev           # Generic\n</code></pre>"},{"location":"developer-guide/#local-services","title":"Local Services","text":"Service Port Condition PostgreSQL 5432 Always PostgREST 3001 <code>database.enabled: true</code> MinIO 9000, 9001 <code>storage.enabled: true</code> Keycloak 8080 <code>auth.enabled: true</code> Redis 6379 <code>redis.enabled: true</code> OpenSearch 9200 <code>search.enabled: true</code> OpenSearch Dashboards 5601 <code>search.enabled: true</code> <p>All services start only if enabled in <code>plattr.yaml</code>. A static site with no database won't start PostgreSQL.</p>"},{"location":"developer-guide/#managing-infrastructure","title":"Managing Infrastructure","text":"<pre><code># Generate AWS CDK config interactively (for deploying to AWS)\nplattr infra init\n\n# Check infrastructure status\nplattr infra status\n\n# Stop infrastructure (data preserved, saves resources)\nplattr infra stop\n\n# Restart stopped infrastructure\nplattr infra start\n\n# Delete everything (cluster, registry, all data)\nplattr infra destroy\n</code></pre>"},{"location":"developer-guide/#custom-port","title":"Custom Port","text":"<pre><code>plattr dev --port 4000\n</code></pre>"},{"location":"developer-guide/#state-files","title":"State Files","text":"<p><code>plattr dev</code> creates a <code>.plattr/</code> directory in your project with: - <code>{appName}.env</code> \u2014 environment variables you can <code>source</code> - <code>{appName}.pids</code> \u2014 port-forward process IDs (managed automatically)</p> <p>Add <code>.plattr/</code> to your <code>.gitignore</code>.</p>"},{"location":"developer-guide/#environment-variables","title":"Environment Variables","text":"<p>Plattr automatically provides these env vars in <code>.plattr/{appName}.env</code>:</p>"},{"location":"developer-guide/#database-when-databaseenabled-true","title":"Database (when <code>database.enabled: true</code>)","text":"Variable Local Value Description <code>DATABASE_URL</code> <code>postgresql://plattr:localdev@127.0.0.1:5432/plattr?search_path=my_app</code> Full connection string <code>POSTGREST_URL</code> <code>http://127.0.0.1:3001</code> PostgREST endpoint"},{"location":"developer-guide/#storage-when-storageenabled-true","title":"Storage (when <code>storage.enabled: true</code>)","text":"Variable Local Value Description <code>S3_ENDPOINT</code> <code>http://127.0.0.1:9000</code> S3 endpoint <code>S3_ACCESS_KEY</code> <code>minioadmin</code> Access key <code>S3_SECRET_KEY</code> <code>minioadmin</code> Secret key <code>S3_REGION</code> <code>us-east-1</code> Region <code>S3_BUCKET_UPLOADS</code> <code>my-app-uploads</code> Bucket name (one per bucket in config) <p>Bucket env var names are derived from the bucket name: <code>uploads</code> becomes <code>S3_BUCKET_UPLOADS</code>, <code>user-files</code> becomes <code>S3_BUCKET_USER_FILES</code>.</p>"},{"location":"developer-guide/#auth-when-authenabled-true","title":"Auth (when <code>auth.enabled: true</code>)","text":"Variable Local Value Description <code>AUTH_ISSUER_URL</code> <code>http://127.0.0.1:8080/realms/my-app</code> OIDC issuer URL <code>AUTH_CLIENT_ID</code> <code>my-app-app</code> OIDC client ID"},{"location":"developer-guide/#redis-when-redisenabled-true","title":"Redis (when <code>redis.enabled: true</code>)","text":"Variable Local Value Description <code>REDIS_URL</code> <code>redis://127.0.0.1:6379</code> Redis connection URL"},{"location":"developer-guide/#opensearch-when-searchenabled-true","title":"OpenSearch (when <code>search.enabled: true</code>)","text":"Variable Local Value Description <code>OPENSEARCH_URL</code> <code>http://127.0.0.1:9200</code> OpenSearch endpoint <code>OPENSEARCH_DASHBOARDS_URL</code> <code>http://127.0.0.1:5601</code> OpenSearch Dashboards UI"},{"location":"developer-guide/#production-equivalents","title":"Production Equivalents","text":"Variable Local Value Production Value <code>DATABASE_URL</code> <code>postgresql://plattr:localdev@127.0.0.1:5432/...</code> <code>postgresql://{app}_app:{random}@aurora:5432/...</code> <code>POSTGREST_URL</code> <code>http://127.0.0.1:3001</code> <code>https://{domain}/api/rest</code> <code>POSTGREST_INTERNAL_URL</code> (not set) <code>http://localhost:3001</code> <code>S3_ENDPOINT</code> <code>http://127.0.0.1:9000</code> (AWS S3 default) <code>AUTH_ISSUER_URL</code> <code>http://127.0.0.1:8080/realms/{app}</code> <code>https://auth.{baseDomain}/realms/{app}</code> <code>REDIS_URL</code> <code>redis://127.0.0.1:6379</code> <code>redis://{managed-redis}:6379</code> <code>OPENSEARCH_URL</code> <code>http://127.0.0.1:9200</code> <code>https://{managed-opensearch}:443</code> <p>In production, <code>POSTGREST_INTERNAL_URL</code> connects directly to the PostgREST sidecar (same pod, no network hop). Use it for server-side calls. Use <code>POSTGREST_URL</code> for client-side/browser calls.</p>"},{"location":"developer-guide/#testing","title":"Testing","text":""},{"location":"developer-guide/#local-tests","title":"Local Tests","text":"<pre><code>plattr test\n</code></pre> <p>Auto-detects your test runner and runs tests using the environment from <code>.plattr/{appName}.env</code>. Requires infrastructure to be running (<code>plattr dev</code> first).</p> <p>Supported test runners (auto-detected): - Vitest \u2014 <code>vitest.config.{ts,js,mts}</code> - Jest \u2014 <code>jest.config.{ts,js,mjs}</code> - npm test \u2014 <code>package.json</code> test script - RSpec \u2014 <code>spec/**/*.rb</code> - Minitest \u2014 <code>test/**/*.rb</code></p>"},{"location":"developer-guide/#ephemeral-ci-tests","title":"Ephemeral CI Tests","text":"<pre><code>plattr test --ci\n</code></pre> <p>Runs Dagger-based tests with clean infrastructure (fresh database, fresh state). Use this in CI pipelines or when you want guaranteed clean state.</p>"},{"location":"developer-guide/#database-workflows","title":"Database Workflows","text":""},{"location":"developer-guide/#running-migrations","title":"Running Migrations","text":"<pre><code># Auto-detect migration engine\nplattr db migrate\n\n# Specify engine explicitly\nplattr db migrate --engine prisma\nplattr db migrate --engine knex\nplattr db migrate --engine raw\n</code></pre> <p>Supported engines: - prisma \u2014 runs <code>npx prisma migrate deploy</code> - knex \u2014 runs <code>npx knex migrate:latest</code> - raw \u2014 executes <code>.sql</code> files from the migrations directory</p>"},{"location":"developer-guide/#seeding-data","title":"Seeding Data","text":"<pre><code># Default seed file\nplattr db seed\n\n# Custom seed file\nplattr db seed --file seeds/test-data.sql\n</code></pre>"},{"location":"developer-guide/#interactive-shell-local","title":"Interactive Shell (Local)","text":"<pre><code>plattr db shell\n</code></pre> <p>Opens a <code>psql</code> session connected to your local database.</p>"},{"location":"developer-guide/#connect-to-remote-database","title":"Connect to Remote Database","text":"<pre><code># Connect to production\nplattr db connect\n\n# Connect to staging\nplattr db connect --env staging\n</code></pre> <p>Retrieves the <code>DATABASE_URL</code> from the Kubernetes Secret and opens a <code>psql</code> session.</p>"},{"location":"developer-guide/#reset-local-database","title":"Reset Local Database","text":"<pre><code>plattr db reset\n</code></pre> <p>Deletes the persistent volume and restarts PostgreSQL. Run <code>plattr dev</code> to recreate schemas.</p>"},{"location":"developer-guide/#schema-and-roles","title":"Schema and Roles","text":"<p>Plattr creates these PostgreSQL objects for your app:</p> <ul> <li>Schema: <code>{env}_{app_name}</code> (e.g., <code>prod_my_app</code>, <code>staging_my_app</code>)</li> <li>App role: <code>{env}_{app_name}_app</code> \u2014 full CRUD access, used by your app</li> <li>Anon role: <code>{env}_{app_name}_anon</code> \u2014 no permissions by default, used by PostgREST</li> </ul> <p>To expose a table through PostgREST, grant permissions to the anon role in your migrations:</p> <pre><code>GRANT SELECT ON my_table TO my_app_anon;\nGRANT INSERT, UPDATE ON my_table TO my_app_anon;\n</code></pre>"},{"location":"developer-guide/#migrations-in-staging-and-production","title":"Migrations in Staging and Production","text":"<p>When you push code with new migrations, here's what happens \u2014 and what doesn't:</p> <p>What the operator handles (once, on first provision): - Creates the database schema (<code>staging_my_app</code>, <code>prod_my_app</code>) - Creates the app role (<code>staging_my_app_app</code>) and anon role (<code>staging_my_app_anon</code>) - Creates the <code>{name}-db</code> Secret containing <code>DATABASE_URL</code></p> <p>What the operator does NOT do: - Run your migration files \u2014 the operator has no knowledge of your migration tool or schema changes</p> <p>How migrations actually run in remote environments:</p> <p>The recommended approach is to run migrations on container startup. Your Dockerfile should include the migration step before starting the app:</p> <pre><code># Example: Prisma\nCMD [\"sh\", \"-c\", \"npx prisma migrate deploy &amp;&amp; node server.js\"]\n\n# Example: Knex\nCMD [\"sh\", \"-c\", \"npx knex migrate:latest &amp;&amp; node server.js\"]\n</code></pre> <p>This way, every time the operator does a rolling update (new <code>imageRef</code> \u2192 new Deployment pods), the new pods run migrations before accepting traffic. Since migration tools are idempotent, only new migrations are applied \u2014 already-applied migrations are skipped.</p> <p>Alternative: run migrations manually via the CLI:</p> <pre><code># Connect to staging DB and run migrations yourself\nplattr db connect --env staging\n# Then run SQL manually, or:\n\n# Port-forward and run your migration tool locally against the remote DB\n# (retrieve the DATABASE_URL from the K8s Secret)\nkubectl get secret my-app-db -n staging -o jsonpath='{.data.DATABASE_URL}' | base64 -d\nDATABASE_URL=&lt;that value&gt; npx prisma migrate deploy\n</code></pre> <p>The typical push workflow with a migration:</p> <ol> <li>Write your migration locally (<code>npx prisma migrate dev</code>, <code>npx knex migrate:make</code>, or raw SQL)</li> <li>Run it locally: <code>plattr db migrate</code></li> <li>Test locally: <code>plattr test</code></li> <li>Push to branch \u2192 CI builds image (with migration files baked in)</li> <li>Operator updates Deployment \u2192 new pods start \u2192 migration runs on startup</li> <li>Verify: <code>plattr status --env staging</code> and <code>plattr logs --env staging</code></li> </ol> <p>Note: If your app does not run migrations on startup, you must run them manually before or after pushing. There is no built-in CI migration step in the generated workflow.</p>"},{"location":"developer-guide/#postgrest-auto-generated-rest-api","title":"PostgREST (Auto-Generated REST API)","text":"<p>When <code>database.enabled: true</code>, you get an auto-generated REST API from your database schema. PostgREST introspects your tables and exposes them as RESTful endpoints.</p>"},{"location":"developer-guide/#local-usage","title":"Local Usage","text":"<pre><code># List all rows in the \"todos\" table\ncurl http://localhost:3001/todos\n\n# Filter\ncurl \"http://localhost:3001/todos?completed=eq.false\"\n\n# Insert\ncurl -X POST http://localhost:3001/todos \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"title\": \"Buy milk\", \"completed\": false}'\n\n# Update\ncurl -X PATCH \"http://localhost:3001/todos?id=eq.1\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"completed\": true}'\n\n# Delete\ncurl -X DELETE \"http://localhost:3001/todos?id=eq.1\"\n</code></pre>"},{"location":"developer-guide/#production-usage","title":"Production Usage","text":"<p>In production, PostgREST runs as a sidecar in your app pod. Requests go through the Ingress:</p> <pre><code>https://my-app.platform.company.dev/api/rest/todos\n</code></pre> <p>The <code>/api/rest</code> prefix is stripped by nginx before reaching PostgREST. From your app's server-side code, use the internal URL for faster access:</p> <pre><code>// Server-side (same pod, no network hop)\nconst res = await fetch(`${process.env.POSTGREST_INTERNAL_URL}/todos`);\n\n// Client-side (browser, goes through Ingress)\nconst res = await fetch(`${process.env.POSTGREST_URL}/todos`);\n</code></pre>"},{"location":"developer-guide/#controlling-access","title":"Controlling Access","text":"<p>By default, PostgREST uses the <code>_anon</code> role which has no table permissions. You control what's exposed in your migrations:</p> <pre><code>-- Expose read-only access\nGRANT SELECT ON todos TO my_app_anon;\n\n-- Expose full CRUD\nGRANT ALL ON todos TO my_app_anon;\n\n-- No grant = not accessible through PostgREST\n</code></pre> <p>Row-level security (RLS) policies are respected automatically.</p>"},{"location":"developer-guide/#schema-reload","title":"Schema Reload","text":"<p>When you run a migration that adds or changes tables, PostgREST automatically detects the change (via PostgreSQL LISTEN/NOTIFY). You can also trigger a manual reload:</p> <pre><code>NOTIFY pgrst, 'reload schema';\n</code></pre>"},{"location":"developer-guide/#object-storage","title":"Object Storage","text":""},{"location":"developer-guide/#using-s3-compatible-storage","title":"Using S3-Compatible Storage","text":"<p>Buckets defined in <code>plattr.yaml</code> are created automatically. Use any S3 SDK:</p> <pre><code>import { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\n\nconst s3 = new S3Client({\n  endpoint: process.env.S3_ENDPOINT,\n  region: process.env.S3_REGION,\n  credentials: {\n    accessKeyId: process.env.S3_ACCESS_KEY,\n    secretAccessKey: process.env.S3_SECRET_KEY,\n  },\n  forcePathStyle: true, // Required for MinIO (local)\n});\n\nawait s3.send(new PutObjectCommand({\n  Bucket: process.env.S3_BUCKET_UPLOADS,\n  Key: 'photo.jpg',\n  Body: fileBuffer,\n}));\n</code></pre>"},{"location":"developer-guide/#local-minio-console","title":"Local MinIO Console","text":"<p>Open <code>http://localhost:9001</code> in your browser. Login with <code>minioadmin</code> / <code>minioadmin</code>.</p>"},{"location":"developer-guide/#public-vs-private-buckets","title":"Public vs Private Buckets","text":"<pre><code>storage:\n  enabled: true\n  buckets:\n    - name: uploads    # Private \u2014 requires signed URLs\n      public: false\n    - name: assets     # Public \u2014 accessible via direct URL\n      public: true\n</code></pre>"},{"location":"developer-guide/#redis","title":"Redis","text":""},{"location":"developer-guide/#local-development_1","title":"Local Development","text":"<p>When <code>redis.enabled: true</code>, a Redis 7 instance runs in the Kind cluster, accessible at <code>redis://127.0.0.1:6379</code>.</p> <pre><code>import { createClient } from 'redis';\n\nconst redis = createClient({ url: process.env.REDIS_URL });\nawait redis.connect();\n\nawait redis.set('key', 'value');\nconst value = await redis.get('key');\n</code></pre>"},{"location":"developer-guide/#reset-redis-data","title":"Reset Redis Data","text":"<pre><code>plattr redis reset\n</code></pre> <p>Deletes the persistent volume and restarts Redis.</p>"},{"location":"developer-guide/#opensearch","title":"OpenSearch","text":""},{"location":"developer-guide/#local-development_2","title":"Local Development","text":"<p>When <code>search.enabled: true</code>, OpenSearch 2.18 runs in the Kind cluster with security disabled for local convenience. The API is available at <code>http://127.0.0.1:9200</code> and the Dashboards UI at <code>http://127.0.0.1:5601</code>.</p> <pre><code>import { Client } from '@opensearch-project/opensearch';\n\nconst client = new Client({ node: process.env.OPENSEARCH_URL });\n\n// Create an index\nawait client.indices.create({ index: 'products' });\n\n// Index a document\nawait client.index({\n  index: 'products',\n  body: { name: 'Widget', price: 9.99 },\n});\n\n// Search\nconst { body } = await client.search({\n  index: 'products',\n  body: { query: { match: { name: 'widget' } } },\n});\n</code></pre>"},{"location":"developer-guide/#opensearch-dashboards","title":"OpenSearch Dashboards","text":"<p>Open <code>http://localhost:5601</code> in your browser for the Dashboards UI (no login required locally).</p>"},{"location":"developer-guide/#reset-opensearch-data","title":"Reset OpenSearch Data","text":"<pre><code>plattr search reset\n</code></pre> <p>Deletes the persistent volume and restarts OpenSearch.</p>"},{"location":"developer-guide/#authentication","title":"Authentication","text":""},{"location":"developer-guide/#local-development_3","title":"Local Development","text":"<p>Keycloak runs at <code>http://localhost:8080</code> with a pre-configured realm matching your app name. A test user and OIDC client are provisioned automatically.</p> <p>Admin console: <code>http://localhost:8080/admin</code> (credentials: <code>admin</code> / <code>admin</code>)</p>"},{"location":"developer-guide/#oidc-integration","title":"OIDC Integration","text":"<p>Use the standard OIDC flow with the provided env vars:</p> <pre><code>// Example: NextAuth.js configuration\nimport KeycloakProvider from 'next-auth/providers/keycloak';\n\nexport const authOptions = {\n  providers: [\n    KeycloakProvider({\n      clientId: process.env.AUTH_CLIENT_ID,\n      issuer: process.env.AUTH_ISSUER_URL,\n    }),\n  ],\n};\n</code></pre>"},{"location":"developer-guide/#identity-providers","title":"Identity Providers","text":"<p>Providers listed in <code>plattr.yaml</code> (google, github, saml, oidc) are noted for configuration but require Plattr-level OAuth credentials set up by your platform team.</p>"},{"location":"developer-guide/#local-deploy-pipeline","title":"Local Deploy Pipeline","text":"<p>Test your production container locally before pushing to CI:</p> <pre><code>plattr deploy local\n</code></pre> <p>This runs a full pipeline: 1. Tests \u2014 auto-detected test runner 2. Build \u2014 production container image via Dagger 3. Push \u2014 to the local registry (<code>localhost:5050</code>) 4. Security scan \u2014 Trivy scans for HIGH/CRITICAL vulnerabilities 5. Deploy \u2014 to the Kind cluster with port-forwarding</p> <pre><code># Skip tests and scan for quick iteration\nplattr deploy local --skip-tests --skip-scan\n\n# Fail on vulnerabilities (CI-style)\nplattr deploy local --fail-on-scan\n\n# Remove the deployment\nplattr undeploy local\n</code></pre>"},{"location":"developer-guide/#deploying-to-production","title":"Deploying to Production","text":""},{"location":"developer-guide/#cicd-pipeline","title":"CI/CD Pipeline","text":"<p><code>plattr init</code> generates <code>.github/workflows/plattr-deploy.yml</code> which:</p> <ol> <li>Builds a production container image</li> <li>Pushes to ECR</li> <li>Updates the <code>Application</code> CRD with the new <code>imageRef</code></li> <li>The operator reconciles the change (rolling update)</li> </ol>"},{"location":"developer-guide/#manual-build-and-deploy","title":"Manual Build and Deploy","text":"<pre><code># Build production image\nplattr build\n\n# Run tests with full infrastructure\nplattr test --ci\n</code></pre>"},{"location":"developer-guide/#environments","title":"Environments","text":"<p>Plattr supports four environments:</p> Environment Namespace Domain Pattern <code>production</code> <code>production</code> <code>{app}.{baseDomain}</code> <code>staging</code> <code>staging</code> <code>{app}.staging.{baseDomain}</code> <code>uat</code> <code>uat</code> <code>{app}.uat.{baseDomain}</code> <code>preview</code> <code>preview-{app}-pr-{N}</code> <code>pr-{N}.{app}.preview.{baseDomain}</code> <p>Each environment gets its own database schema, storage buckets, and Keycloak realm \u2014 fully isolated.</p>"},{"location":"developer-guide/#preview-environments","title":"Preview Environments","text":"<p>Every pull request can get an isolated preview environment with its own database, storage, and URL.</p>"},{"location":"developer-guide/#local-preview","title":"Local Preview","text":"<pre><code>plattr preview start --pr 42\nplattr preview start --pr 42 --port 3100\n</code></pre>"},{"location":"developer-guide/#remote-preview","title":"Remote Preview","text":"<p>Remote previews are created automatically when a <code>PreviewEnvironment</code> CRD is applied (typically from CI). List active previews:</p> <pre><code>plattr preview list\n</code></pre> <p>Output:</p> <pre><code>PR   App          Phase     URL                                          Expires\n42   my-app       Running   https://pr-42.my-app.preview.company.dev     2024-01-15T12:00:00Z\n87   my-app       Running   https://pr-87.my-app.preview.company.dev     2024-01-16T08:00:00Z\n</code></pre> <p>Preview environments have a TTL (default 72 hours) and are automatically cleaned up when they expire.</p>"},{"location":"developer-guide/#managing-environment-variables","title":"Managing Environment Variables","text":""},{"location":"developer-guide/#set-variables","title":"Set Variables","text":"<pre><code># Set one or more variables\nplattr env set API_KEY=abc123\nplattr env set API_KEY=abc123 FEATURE_FLAG=true\n\n# Target a specific environment\nplattr env set --env staging API_KEY=staging-key\n</code></pre>"},{"location":"developer-guide/#list-variables","title":"List Variables","text":"<pre><code>plattr env list\nplattr env list --env staging\n</code></pre> <p>Output shows both Plattr-managed and user-defined variables:</p> <pre><code>Plattr-managed:\n  DATABASE_URL    = postgresql://...\n  DB_HOST         = aurora-cluster.us-east-1.rds.amazonaws.com\n  S3_ENDPOINT     = https://s3.us-east-1.amazonaws.com\n  ...\n\nUser-defined:\n  API_KEY         = abc123\n  FEATURE_FLAG    = true\n</code></pre>"},{"location":"developer-guide/#remove-variables","title":"Remove Variables","text":"<pre><code>plattr env unset API_KEY\nplattr env unset --env staging API_KEY\n</code></pre> <p>Setting or unsetting variables triggers a deployment restart to pick up the changes.</p>"},{"location":"developer-guide/#monitoring","title":"Monitoring","text":""},{"location":"developer-guide/#application-status","title":"Application Status","text":"<pre><code>plattr status\nplattr status --env staging\nplattr status --pr 42\n</code></pre> <p>Shows phase (Pending, Provisioning, Running, Failed) and condition status for each subsystem.</p>"},{"location":"developer-guide/#application-logs","title":"Application Logs","text":"<pre><code># Recent logs\nplattr logs\n\n# Stream logs\nplattr logs -f\n\n# Last 100 lines\nplattr logs --tail 100\n\n# Staging environment\nplattr logs --env staging\n\n# Preview environment\nplattr logs --pr 42\n</code></pre> <p>Logs include all containers in the pod (app + PostgREST sidecar if enabled).</p>"},{"location":"developer-guide/#example-nextjs-app-from-scratch","title":"Example: Next.js App from Scratch","text":"<pre><code># 1. Create Next.js app\nnpx create-next-app@latest my-app\ncd my-app\n\n# 2. Initialize plattr config\nplattr init\n# Choose: nextjs, enable database, enable storage, enable auth\n\n# 3. Start local infrastructure\nplattr dev\n\n# 4. Source env vars and start dev server\nsource .plattr/my-app.env\nnpx next dev\n# App on :3000, DB on :5432, Storage on :9000, Auth on :8080, REST API on :3001\n\n# 5. Create a migration (example with Prisma)\nnpx prisma init\n# Edit prisma/schema.prisma, then:\nnpx prisma migrate dev --name init\n\n# 6. Grant PostgREST access to your tables\n# In a migration file:\n# GRANT SELECT, INSERT, UPDATE, DELETE ON todos TO my_app_anon;\n\n# 7. Test the REST API\ncurl http://localhost:3001/todos\n\n# 8. Run tests\nplattr test\n\n# 9. Test production container locally\nplattr deploy local\n\n# 10. Push to deploy\ngit add . &amp;&amp; git commit -m \"Initial app\"\ngit push origin main\n# CI builds, pushes image, operator deploys\n\n# 11. Check status\nplattr status\n</code></pre>"},{"location":"developer-guide/#example-rails-app-from-scratch","title":"Example: Rails App from Scratch","text":"<pre><code># 1. Create Rails app\nrails new my-rails-app --database=postgresql\ncd my-rails-app\n\n# 2. Initialize plattr config\nplattr init\n# Choose: rails, enable database\n\n# 3. Update database.yml to use plattr env vars\n# config/database.yml:\n#   default: &amp;default\n#     adapter: postgresql\n#     url: &lt;%= ENV['DATABASE_URL'] %&gt;\n\n# 4. Start local infrastructure\nplattr dev\n\n# 5. Source env vars and start dev server\nsource .plattr/my-rails-app.env\nbin/rails server\n\n# 6. Run migrations\nplattr db migrate --engine raw\n\n# 7. Push to deploy\ngit add . &amp;&amp; git commit -m \"Initial app\"\ngit push origin main\n</code></pre>"},{"location":"platform-rollout-plan/","title":"Plattr Platform Rollout Plan","text":""},{"location":"platform-rollout-plan/#current-state","title":"Current State","text":"<p>The local developer workflow (<code>plattr dev</code> / <code>plattr deploy local</code>) is solid. The code for the platform side is largely written \u2014 CDK stacks, operator, Helm chart, Dagger pipeline, CRDs \u2014 but there are gaps in the glue that connects a GitHub push to a running deployment on a real cluster.</p>"},{"location":"platform-rollout-plan/#the-end-to-end-flow-and-where-it-breaks","title":"The End-to-End Flow (and where it breaks)","text":"<pre><code>Developer pushes to GitHub\n  \u2192 GitHub Actions workflow fires\n  \u2192 AWS OIDC auth (CI/CD stack role)\n  \u2192 Dagger: test \u2192 build \u2192 push image to ECR\n  \u2192 [STUB] kubectl apply Application CR     \u2190 not implemented\n  \u2192 Operator detects CR, reconciles everything\n  \u2192 App is live\n</code></pre> <p>The build/push part works. The deploy steps are <code>echo</code> placeholders.</p>"},{"location":"platform-rollout-plan/#recommended-order-of-operations","title":"Recommended Order of Operations","text":""},{"location":"platform-rollout-plan/#step-1-provision-eks-cluster-aurora-postgresql","title":"Step 1: Provision EKS cluster + Aurora PostgreSQL","text":"<p>The CDK stacks import an existing cluster \u2014 they don't create one. You need:</p> <ul> <li>An EKS cluster (with OIDC provider enabled for IRSA)</li> <li>An Aurora PostgreSQL instance (the operator needs <code>DB_ADMIN_URL</code>)</li> <li>Collect: cluster name, kubectl role ARN, OIDC provider ARN, Aurora endpoint, security group ID</li> </ul> <p>See Step 1 Tutorial for exact commands.</p>"},{"location":"platform-rollout-plan/#step-2-deploy-the-cdk-operator-stack","title":"Step 2: Deploy the CDK Operator Stack","text":"<pre><code>cd packages/cdk\nnpx cdk deploy PlattrOperatorStack \\\n  -c eksClusterName=&lt;cluster&gt; \\\n  -c kubectlRoleArn=&lt;arn&gt; \\\n  -c oidcProviderArn=&lt;arn&gt; \\\n  -c auroraEndpoint=&lt;endpoint&gt; \\\n  -c auroraSgId=&lt;sg-id&gt; \\\n  -c baseDomain=&lt;domain&gt; \\\n  -c hostedZoneId=&lt;zone-id&gt;\n</code></pre> <p>This installs CRDs, creates the <code>plattr-system</code> namespace, sets up IRSA, deploys the operator via Helm, creates environment namespaces with quotas, and optionally installs cert-manager, external-dns, ingress-nginx, and Keycloak.</p> <p>Prerequisite: Build and push the operator image to ECR first (no automation for this yet).</p>"},{"location":"platform-rollout-plan/#step-3-deploy-the-cdk-cicd-stack","title":"Step 3: Deploy the CDK CI/CD Stack","text":"<pre><code>npx cdk deploy PlattrCicdStack -c githubOrg=&lt;your-org&gt;\n</code></pre> <p>Creates the GitHub OIDC provider and IAM roles for GitHub Actions to push to ECR and interact with EKS.</p>"},{"location":"platform-rollout-plan/#step-4-fill-in-the-deploy-stubs-in-the-workflow-template","title":"Step 4: Fill in the deploy stubs in the workflow template","text":"<p>The file <code>manifests/templates/plattr-deploy.yml</code> has working build/test jobs but the deploy steps (preview, staging, UAT, production) are all <code>echo</code> placeholders. These need <code>kubectl apply</code> commands to create/update Application CRs on the cluster.</p>"},{"location":"platform-rollout-plan/#known-gaps","title":"Known Gaps","text":"Gap Impact Deploy steps are stubs in the GitHub Actions template No actual deployment happens after image push No operator image CI/CD Operator image must be manually built and pushed to ECR Keycloak DB secret not created by CDK Keycloak won't start without it <code>KEYCLOAK_ADMIN_PASSWORD</code> not wired in Helm deployment template Operator can't manage Keycloak realms No <code>plattr init</code> command The workflow template can't be scaffolded into developer repos Redis/OpenSearch reconcilers not implemented CRD fields exist but operator ignores them"},{"location":"plattr-team-guide/","title":"Plattr Team Guide","text":"<p>This guide covers deploying, operating, and maintaining Plattr. It assumes familiarity with Kubernetes, AWS, and infrastructure tooling.</p>"},{"location":"plattr-team-guide/#prerequisites","title":"Prerequisites","text":"<ul> <li>AWS CLI configured with admin-level credentials</li> <li>AWS CDK v2 \u2014 <code>npm install -g aws-cdk</code></li> <li>kubectl connected to your EKS cluster</li> <li>Helm v3</li> <li>Node.js 18+ and npm</li> <li>Docker (for CDK asset bundling)</li> </ul>"},{"location":"plattr-team-guide/#infrastructure-overview","title":"Infrastructure Overview","text":"<p>Plattr uses a two-account architecture: non-prod services run containerized on a single EKS cluster, while production runs in a separate AWS account with managed services.</p> <pre><code>Non-Prod Account                         Prod Account\n\u251c\u2500\u2500 EKS (plattr-nonprod)                 \u251c\u2500\u2500 EKS (plattr-prod)\n\u2502   \u251c\u2500\u2500 plattr-system namespace          \u2502   \u251c\u2500\u2500 plattr-system namespace\n\u2502   \u2502   \u251c\u2500\u2500 Operator (container mode)    \u2502   \u2502   \u251c\u2500\u2500 Operator (managed mode)\n\u2502   \u2502   \u251c\u2500\u2500 PostgreSQL pod               \u2502   \u2502   \u251c\u2500\u2500 Keycloak (StatefulSet)\n\u2502   \u2502   \u251c\u2500\u2500 MinIO pod                    \u2502   \u2502   \u251c\u2500\u2500 cert-manager, ext-dns, nginx\n\u2502   \u2502   \u251c\u2500\u2500 Redis pod                    \u2502   \u2502   \u2514\u2500\u2500 (no container services)\n\u2502   \u2502   \u251c\u2500\u2500 OpenSearch pod               \u2502   \u251c\u2500\u2500 production namespace\n\u2502   \u2502   \u251c\u2500\u2500 Keycloak pod                 \u2502   \u2514\u2500\u2500 (no staging/uat/preview)\n\u2502   \u2502   \u2514\u2500\u2500 cert-manager, ext-dns...     \u2502\n\u2502   \u251c\u2500\u2500 staging namespace                \u251c\u2500\u2500 Aurora PostgreSQL Serverless v2\n\u2502   \u251c\u2500\u2500 uat namespace                    \u251c\u2500\u2500 ElastiCache (Redis 7)\n\u2502   \u2514\u2500\u2500 preview-* namespaces (dynamic)   \u251c\u2500\u2500 OpenSearch Service\n\u2502                                         \u251c\u2500\u2500 S3\n\u251c\u2500\u2500 ECR                                   \u251c\u2500\u2500 ECR (cross-account pull)\n\u2502   \u251c\u2500\u2500 plattr-operator                  \u2514\u2500\u2500 Route 53\n\u2502   \u2514\u2500\u2500 plattr-apps\n\u251c\u2500\u2500 S3 (bucket-per-app)\n\u251c\u2500\u2500 Secrets Manager\n\u2502   \u2514\u2500\u2500 plattr/db-admin\n\u2514\u2500\u2500 Route 53\n</code></pre>"},{"location":"plattr-team-guide/#cdk-deployment","title":"CDK Deployment","text":"<p>The infrastructure is defined in three CDK stacks. All commands run from <code>packages/cdk</code>.</p>"},{"location":"plattr-team-guide/#quick-start-with-plattr-infra-init","title":"Quick Start with <code>plattr infra init</code>","text":"<p>The fastest way to configure CDK context values is the interactive init command:</p> <pre><code>plattr infra init\n</code></pre> <p>This walks you through environment type, AWS account/region, cluster sizing, domain config, and add-ons, then writes a <code>packages/cdk/cdk.json</code> with all values populated. After that:</p> <pre><code>cd packages/cdk\nnpm install\nnpx cdk bootstrap\nnpx cdk deploy --all\n</code></pre>"},{"location":"plattr-team-guide/#manual-deployment-modes","title":"Manual Deployment Modes","text":"<p>Alternatively, you can pass context values directly via <code>-c</code> flags. There are two modes depending on whether you want CDK to manage the foundational infrastructure (VPC, EKS, Aurora) or you're bringing your own.</p>"},{"location":"plattr-team-guide/#option-a-cdk-managed-infrastructure-recommended-for-new-environments","title":"Option A: CDK-managed infrastructure (recommended for new environments)","text":"<p>Set <code>-c useInfraStack=true</code> and CDK provisions everything end-to-end. The <code>PlattrInfraStack</code> creates the VPC, EKS cluster, and Aurora database, then wires them directly into the operator stack \u2014 no manual ARN/endpoint copying required.</p> <pre><code># First-time bootstrap (once per account/region)\nnpx cdk bootstrap aws://ACCOUNT_ID/ca-central-1\n\n# Deploy infra + operator together\nnpx cdk deploy PlattrInfraStack PlattrOperatorStack \\\n  -c useInfraStack=true \\\n  -c account=ACCOUNT_ID \\\n  -c region=ca-central-1 \\\n  -c baseDomain=nonprod.yourcompany.dev \\\n  -c hostedZoneId=Z0123456789\n</code></pre> <p>CDK handles cross-stack references automatically. The infra stack exports the cluster name, OIDC provider ARN, Aurora endpoint, and security group ID \u2014 the operator stack consumes them without any manual input.</p>"},{"location":"plattr-team-guide/#option-b-bring-your-own-infrastructure","title":"Option B: Bring your own infrastructure","text":"<p>If you already have an EKS cluster and Aurora database (or manage them outside CDK), keep the default mode and pass the values via <code>-c</code> context flags:</p> <pre><code>npx cdk deploy PlattrOperatorStack \\\n  -c eksClusterName=my-eks-cluster \\\n  -c kubectlRoleArn=arn:aws:iam::123456789012:role/my-kubectl-role \\\n  -c oidcProviderArn=arn:aws:iam::123456789012:oidc-provider/oidc.eks... \\\n  -c auroraEndpoint=my-aurora.cluster-xxx.ca-central-1.rds.amazonaws.com \\\n  -c auroraSgId=sg-xxxxx \\\n  -c baseDomain=nonprod.yourcompany.dev \\\n  -c hostedZoneId=Z0123456789\n</code></pre> <p>See Step 1: Manual Setup for how to create these resources with <code>eksctl</code> and AWS CLI.</p>"},{"location":"plattr-team-guide/#stack-1-plattrinfrastack","title":"Stack 1: PlattrInfraStack","text":"<p>Provisions the foundational AWS infrastructure. Only deployed when using <code>-c useInfraStack=true</code>.</p> <pre><code># Preview changes\nnpx cdk diff PlattrInfraStack -c useInfraStack=true\n\n# Deploy\nnpx cdk deploy PlattrInfraStack -c useInfraStack=true\n</code></pre> <p>What it creates: - VPC with public/private subnets across 2 AZs, 1 NAT gateway - EKS cluster (K8s 1.33) with Auto Mode (compute fully managed by EKS) - kubectl IAM role for CDK and manual cluster access - OIDC provider for IRSA (auto-enabled by the EKS construct) - Aurora Serverless v2 (PostgreSQL 16.4, 0.5-4 ACU scaling, <code>plattr</code> default database) - Security group rule allowing EKS cluster SG \u2192 Aurora on port 5432</p> <p>Stack outputs:</p> Output Description <code>ClusterName</code> EKS cluster name <code>KubectlRoleArn</code> IAM role for kubectl access <code>OidcProviderArn</code> OIDC provider ARN for IRSA <code>AuroraEndpoint</code> Aurora cluster writer endpoint <code>AuroraSecurityGroupId</code> Aurora security group ID <p>Customizable props:</p> Context key Default Description <code>eksClusterName</code> <code>plattr-nonprod</code> EKS cluster name <code>auroraMinCapacity</code> <code>0.5</code> Aurora Serverless v2 min ACU <code>auroraMaxCapacity</code> <code>4</code> Aurora Serverless v2 max ACU"},{"location":"plattr-team-guide/#stack-2-plattroperatorstack","title":"Stack 2: PlattrOperatorStack","text":"<p>Deploys the operator, add-ons, CRDs, and environment namespaces.</p> <pre><code># Review what will be deployed\nnpx cdk diff PlattrOperatorStack\n\n# Deploy\nnpx cdk deploy PlattrOperatorStack\n</code></pre> <p>What it creates: - plattr-system namespace with CRDs (Application, PreviewEnvironment) - Secrets Manager secret (<code>plattr/db-admin</code>) for Aurora admin credentials - ECR repository (<code>plattr-operator</code>) with 25-image retention - IRSA role for the operator ServiceAccount with permissions for S3, Secrets Manager, and STS - Operator Helm release with configuration (DB secret ARN, host, region, base domain, Keycloak URL) - Environment namespaces (staging, uat, production) with resource quotas - Add-ons (all enabled by default):   - cert-manager + Let's Encrypt ClusterIssuer   - external-dns with Route 53   - ingress-nginx with AWS NLB   - Keycloak 26.0 (2 replicas, external PostgreSQL, HTTPS Ingress)</p> <p>Additional context flags (operator stack):</p> Key Default Description <code>baseDomain</code> <code>platform.company.dev</code> Base domain for app ingresses <code>hostedZoneId</code> \u2014 Route 53 hosted zone ID <code>installCertManager</code> <code>true</code> Install cert-manager <code>installExternalDns</code> <code>true</code> Install external-dns <code>installIngressNginx</code> <code>true</code> Install ingress-nginx <code>installKeycloak</code> <code>true</code> Install Keycloak"},{"location":"plattr-team-guide/#option-c-production-account-separate-aws-account-with-managed-services","title":"Option C: Production account (separate AWS account with managed services)","text":"<p>Set <code>-c target=prod</code> to deploy production infrastructure with AWS managed services (Aurora, ElastiCache, OpenSearch) in a dedicated account.</p> <pre><code># Bootstrap the prod account\nnpx cdk bootstrap aws://PROD_ACCOUNT_ID/ca-central-1\n\n# Deploy prod infra + operator\nnpx cdk deploy PlattrProdInfraStack PlattrProdOperatorStack \\\n  -c target=prod \\\n  -c account=PROD_ACCOUNT_ID \\\n  -c region=ca-central-1 \\\n  -c baseDomain=prod.yourcompany.dev \\\n  -c hostedZoneId=Z987654321 \\\n  -c nonprodAccountId=NONPROD_ACCOUNT_ID\n</code></pre> <p>The prod stack creates: - EKS cluster (<code>plattr-prod</code>) with Auto Mode (compute fully managed by EKS) - Aurora Serverless v2 with higher ACUs (1-8 default) - ElastiCache Serverless (Redis 7) \u2014 operator uses <code>REDIS_ENDPOINT</code> - OpenSearch Service (2-node t3.medium.search) \u2014 operator uses <code>OPENSEARCH_ENDPOINT</code> - Cross-account ECR pull role for pulling images from non-prod - Only the <code>production</code> namespace (no staging/uat/preview)</p> <p>The operator runs in managed mode: instead of pointing to in-cluster pods, it creates ConfigMaps with endpoints for the AWS managed services.</p> <p>See Production Account Setup for the full step-by-step guide.</p>"},{"location":"plattr-team-guide/#stack-3-plattrcicdstack","title":"Stack 3: PlattrCicdStack","text":"<p>Sets up CI/CD roles for GitHub Actions.</p> <pre><code>npx cdk deploy PlattrCicdStack\n</code></pre> <p>What it creates: - GitHub OIDC provider for keyless authentication - ECR repository (<code>plattr-apps</code>) with 50-image retention - CI Deploy Role \u2014 non-prod deployments from any branch (ECR push + EKS describe) - Prod Deploy Role \u2014 production deployments from main branch only</p> <p>Context flags:</p> Key Default Description <code>githubOrg</code> \u2014 GitHub organization name <code>githubRepoFilter</code> \u2014 Optional repo name filter <code>prodAccountId</code> \u2014 Production AWS account ID (enables cross-account deploy)"},{"location":"plattr-team-guide/#operator-management","title":"Operator Management","text":""},{"location":"plattr-team-guide/#how-the-operator-works","title":"How the Operator Works","text":"<p>The operator watches two Custom Resource types:</p> <ol> <li>Application \u2014 represents a deployed app. The operator reconciles it into database schemas, S3 buckets, Keycloak realms, Deployments, Services, Ingresses, and HPAs.</li> <li>PreviewEnvironment \u2014 represents a PR preview. The operator creates an isolated namespace with its own database schema, storage, and workload.</li> </ol> <p>Reconciliation is triggered by Kubernetes informers (watch events). The operator uses generation-based tracking to avoid infinite loops from status updates.</p>"},{"location":"plattr-team-guide/#operator-configuration","title":"Operator Configuration","text":"<p>The operator reads configuration from environment variables:</p> Variable Description Required <code>DB_ADMIN_URL</code> PostgreSQL admin connection string (dev mode) One of these <code>DB_SECRET_ARN</code> AWS Secrets Manager ARN (prod mode) required <code>DB_HOST</code> Aurora cluster endpoint Yes <code>AWS_REGION</code> AWS region Yes <code>BASE_DOMAIN</code> Plattr base domain Yes <code>KEYCLOAK_URL</code> Keycloak base URL If auth enabled <code>KEYCLOAK_ADMIN_USER</code> Keycloak admin username If auth enabled <code>KEYCLOAK_ADMIN_PASSWORD</code> Keycloak admin password If auth enabled <code>REDIS_ENDPOINT</code> ElastiCache Redis endpoint (managed mode) No (empty = container mode) <code>OPENSEARCH_ENDPOINT</code> OpenSearch Service endpoint (managed mode) No (empty = container mode) <code>LEADER_ELECTION</code> Enable leader election (<code>true</code>/<code>false</code>) No (default: false) <code>LEASE_NAMESPACE</code> Namespace for leader lease If leader election on <code>AWS_ENDPOINT_URL</code> Override AWS endpoint (for LocalStack) No"},{"location":"plattr-team-guide/#viewing-operator-logs","title":"Viewing Operator Logs","text":"<pre><code>kubectl logs -n plattr-system -l app=plattr-operator -f --all-containers\n</code></pre>"},{"location":"plattr-team-guide/#leader-election","title":"Leader Election","text":"<p>For high-availability (multiple operator replicas), enable leader election:</p> <pre><code>env:\n  - name: LEADER_ELECTION\n    value: \"true\"\n  - name: LEASE_NAMESPACE\n    value: plattr-system\n</code></pre> <p>The operator creates a <code>Lease</code> resource (<code>plattr-operator-leader</code>). Only the leader processes reconciliation events. Lease duration is 15 seconds with 5-second renewal intervals.</p>"},{"location":"plattr-team-guide/#scaling-the-operator","title":"Scaling the Operator","text":"<p>The operator runs as a single Deployment. With leader election enabled, you can run multiple replicas for failover:</p> <pre><code>kubectl scale deployment plattr-operator -n plattr-system --replicas=2\n</code></pre> <p>Only the leader processes events; standbys take over if the leader's lease expires.</p>"},{"location":"plattr-team-guide/#crd-management","title":"CRD Management","text":""},{"location":"plattr-team-guide/#installing-crds","title":"Installing CRDs","text":"<pre><code>kubectl apply -f manifests/crds/application.yaml\nkubectl apply -f manifests/crds/preview-environment.yaml\n</code></pre>"},{"location":"plattr-team-guide/#verifying-crds","title":"Verifying CRDs","text":"<pre><code>kubectl get crd applications.platform.internal\nkubectl get crd previewenvironments.platform.internal\n</code></pre>"},{"location":"plattr-team-guide/#creating-an-application","title":"Creating an Application","text":"<pre><code>apiVersion: platform.internal/v1alpha1\nkind: Application\nmetadata:\n  name: my-frontend\n  namespace: default\nspec:\n  repository: github.com/myorg/my-frontend\n  framework: nextjs\n  environment: production\n  imageRef: 123456789.dkr.ecr.us-east-1.amazonaws.com/plattr-apps:my-frontend-abc123\n  database:\n    enabled: true\n  storage:\n    enabled: true\n    buckets:\n      - name: uploads\n        public: false\n  auth:\n    enabled: true\n    providers: [google, github]\n  scaling:\n    min: 2\n    max: 20\n    targetCPU: 70\n</code></pre> <pre><code>kubectl apply -f my-app.yaml\n</code></pre>"},{"location":"plattr-team-guide/#checking-application-status","title":"Checking Application Status","text":"<pre><code># Summary\nkubectl get applications\n\n# Detailed status\nkubectl get application my-frontend -o yaml\n\n# Status conditions\nkubectl get application my-frontend -o jsonpath='{.status.conditions}' | python3 -m json.tool\n</code></pre> <p>Status phases: <code>Pending</code> \u2192 <code>Provisioning</code> \u2192 <code>Running</code> (or <code>Failed</code>)</p> <p>See the full CRD Reference.</p>"},{"location":"plattr-team-guide/#supporting-add-ons","title":"Supporting Add-Ons","text":""},{"location":"plattr-team-guide/#cert-manager","title":"cert-manager","text":"<p>Provides automatic TLS certificates via Let's Encrypt.</p> <pre><code># Verify cert-manager is running\nkubectl get pods -n cert-manager\n\n# Check ClusterIssuer\nkubectl get clusterissuer letsencrypt-prod\n\n# Debug certificate issues\nkubectl get certificates -A\nkubectl describe certificate &lt;name&gt; -n &lt;namespace&gt;\n</code></pre>"},{"location":"plattr-team-guide/#external-dns","title":"external-dns","text":"<p>Automatically creates DNS records in Route 53 from Ingress resources.</p> <pre><code># Verify external-dns is running\nkubectl get pods -n kube-system -l app=external-dns\n\n# Check logs for DNS sync\nkubectl logs -n kube-system -l app=external-dns\n</code></pre>"},{"location":"plattr-team-guide/#ingress-nginx","title":"ingress-nginx","text":"<p>Routes external traffic to services via an AWS Network Load Balancer.</p> <pre><code># Verify ingress controller\nkubectl get pods -n ingress-nginx\n\n# Check NLB\nkubectl get svc -n ingress-nginx ingress-nginx-controller\n\n# List all Ingress resources\nkubectl get ingress -A\n</code></pre>"},{"location":"plattr-team-guide/#keycloak","title":"Keycloak","text":"<p>Managed authentication provider running on EKS.</p> <pre><code># Check Keycloak pods\nkubectl get pods -n plattr-system -l app=keycloak\n\n# Access admin console (port-forward)\nkubectl port-forward -n plattr-system svc/keycloak 8443:443\n# Open https://localhost:8443/admin\n</code></pre>"},{"location":"plattr-team-guide/#monitoring","title":"Monitoring","text":""},{"location":"plattr-team-guide/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>The operator exposes Prometheus metrics on port 9090 (default Express server):</p> Metric Type Description <code>application_phase</code> Gauge Current phase of each Application (labeled by name, namespace, phase) <code>reconcile_total</code> Counter Total reconciliation count (labeled by name, result: success/failure)"},{"location":"plattr-team-guide/#health-checks","title":"Health Checks","text":"<p>The operator exposes a health endpoint. Check it with:</p> <pre><code>kubectl exec -n plattr-system deploy/plattr-operator -- curl -s localhost:9090/healthz\n</code></pre>"},{"location":"plattr-team-guide/#resource-quotas","title":"Resource Quotas","text":"<p>Each environment namespace has resource quotas (configured in CDK):</p> <pre><code>kubectl get resourcequota -n production\nkubectl get resourcequota -n staging\nkubectl get resourcequota -n uat\n</code></pre>"},{"location":"plattr-team-guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"plattr-team-guide/#application-stuck-in-provisioning","title":"Application Stuck in \"Provisioning\"","text":"<ol> <li> <p>Check operator logs for errors:    <pre><code>kubectl logs -n plattr-system -l app=plattr-operator --tail=100\n</code></pre></p> </li> <li> <p>Check Application conditions:    <pre><code>kubectl get application my-app -o jsonpath='{.status.conditions}' | python3 -m json.tool\n</code></pre></p> </li> <li> <p>Common causes:</p> </li> <li>DatabaseReady: False \u2014 Aurora connectivity issue, check DB_ADMIN_URL or DB_SECRET_ARN</li> <li>StorageReady: False \u2014 S3/IAM permissions issue, check operator IRSA role</li> <li>AuthReady: False \u2014 Keycloak unreachable, check Keycloak pods</li> <li>DeploymentReady: False \u2014 Pods failing to start, check <code>kubectl describe pod</code></li> </ol>"},{"location":"plattr-team-guide/#application-stuck-in-failed","title":"Application Stuck in \"Failed\"","text":"<p>The operator retries up to 3 times with exponential backoff (1s, 2s, 4s). If it fails:</p> <ol> <li>Fix the underlying issue</li> <li>Trigger re-reconciliation by touching the spec:    <pre><code>kubectl patch application my-app --type=merge -p '{\"spec\":{\"scaling\":{\"min\":2}}}'\n</code></pre></li> </ol>"},{"location":"plattr-team-guide/#preview-environment-not-cleaning-up","title":"Preview Environment Not Cleaning Up","text":"<p>The TTL controller runs every 5 minutes. Check:</p> <pre><code># List previews with expiry\nkubectl get previewenvironments -o custom-columns=NAME:.metadata.name,EXPIRES:.status.expiresAt\n\n# Manually delete\nkubectl delete previewenvironment my-app-pr-42\n</code></pre>"},{"location":"plattr-team-guide/#postgrest-sidecar-not-working","title":"PostgREST Sidecar Not Working","text":"<ol> <li> <p>Check both containers in the pod:    <pre><code>kubectl get pods -l app.kubernetes.io/name=my-app\nkubectl logs &lt;pod&gt; -c postgrest\n</code></pre></p> </li> <li> <p>Common issues:</p> </li> <li>Connection refused \u2014 database schema or role doesn't exist yet (migration not run)</li> <li>Empty response \u2014 no tables granted to the <code>_anon</code> role</li> <li>Schema not found \u2014 schema name mismatch (check <code>PGRST_DB_SCHEMAS</code> env var)</li> </ol>"},{"location":"plattr-team-guide/#database-connection-issues","title":"Database Connection Issues","text":"<pre><code># Check the DB secret exists\nkubectl get secret my-app-db -n production -o yaml\n\n# Test connectivity from a pod\nkubectl run -it --rm pg-test --image=postgres:14 -- psql \"$(kubectl get secret my-app-db -n production -o jsonpath='{.data.DATABASE_URL}' | base64 -d)\"\n</code></pre>"},{"location":"plattr-team-guide/#operator-crash-loop","title":"Operator Crash Loop","text":"<pre><code># Check events\nkubectl get events -n plattr-system --sort-by='.lastTimestamp'\n\n# Check resource limits\nkubectl describe pod -n plattr-system -l app=plattr-operator\n</code></pre> <p>Common causes: - Missing IRSA role (check ServiceAccount annotation) - Invalid DB_SECRET_ARN - Kubernetes API permissions (check RBAC)</p>"},{"location":"plattr-team-guide/#day-2-operations","title":"Day-2 Operations","text":""},{"location":"plattr-team-guide/#upgrading-the-operator","title":"Upgrading the Operator","text":"<ol> <li>Build and push new operator image to ECR</li> <li>Update the Helm values or CDK context with the new image tag</li> <li>Deploy:    <pre><code>npx cdk deploy PlattrOperatorStack\n</code></pre>    Or update the Helm release directly:    <pre><code>helm upgrade plattr-operator ./chart -n plattr-system --set image.tag=new-version\n</code></pre></li> </ol>"},{"location":"plattr-team-guide/#upgrading-postgrest","title":"Upgrading PostgREST","text":"<p>The PostgREST version is pinned in the operator code (<code>postgrest/postgrest:v12.2.3</code>). To upgrade:</p> <ol> <li>Update the version in <code>packages/operator/src/reconcilers/workload.ts</code></li> <li>Rebuild and deploy the operator</li> <li>All apps will get the new PostgREST version on next reconciliation</li> </ol>"},{"location":"plattr-team-guide/#database-backups","title":"Database Backups","text":"<p>Aurora handles automated backups. For manual snapshots:</p> <pre><code>aws rds create-db-cluster-snapshot \\\n  --db-cluster-identifier plattr-aurora \\\n  --db-cluster-snapshot-identifier manual-$(date +%Y%m%d)\n</code></pre>"},{"location":"plattr-team-guide/#scaling-infrastructure","title":"Scaling Infrastructure","text":"<p>More app replicas: Adjust <code>scaling.min</code> and <code>scaling.max</code> in the Application spec. HPA handles the rest.</p> <p>More Aurora capacity: Scale through AWS console or CDK.</p> <p>More Keycloak capacity: Scale the StatefulSet: <pre><code>kubectl scale statefulset keycloak -n plattr-system --replicas=3\n</code></pre></p>"},{"location":"plattr-team-guide/#adding-a-new-environment","title":"Adding a New Environment","text":"<ol> <li>Add the namespace in CDK (<code>PlattrOperatorStack</code>)</li> <li>Deploy: <code>npx cdk deploy PlattrOperatorStack</code></li> <li>Update the CLI's <code>resolveEnv()</code> function to map the new environment name to namespace</li> <li>Update CI/CD workflows to support the new environment</li> </ol>"},{"location":"plattr-team-guide/#rotating-database-credentials","title":"Rotating Database Credentials","text":"<ol> <li>Update the secret in AWS Secrets Manager</li> <li>Restart the operator to pick up new credentials:    <pre><code>kubectl rollout restart deployment plattr-operator -n plattr-system\n</code></pre></li> <li>App-level credentials (per-schema roles) are generated by the operator and stored in Kubernetes Secrets. To rotate, delete the Secret and let the operator recreate it:    <pre><code>kubectl delete secret my-app-db -n production\n# Operator will detect the missing Secret and recreate it with new credentials\n</code></pre></li> </ol>"},{"location":"step1-eks-aurora-setup/","title":"Step 1: Provision EKS Cluster + Aurora PostgreSQL","text":"<p>This tutorial walks you through creating the minimum infrastructure needed for the Plattr non-prod cluster. By the end, you'll have an EKS cluster and Aurora PostgreSQL database ready for the CDK operator stack.</p>"},{"location":"step1-eks-aurora-setup/#prerequisites","title":"Prerequisites","text":"<p>Install these tools before starting:</p> <pre><code># AWS CLI v2\naws --version   # needs 2.x\n\n# Node.js\nnode --version  # needs 18+\n\n# AWS CDK\nnpx cdk --version\n\n# kubectl\nkubectl version --client\n</code></pre> <p>Ensure your AWS credentials are configured:</p> <pre><code>aws sts get-caller-identity\n</code></pre> <p>You should see your account ID and ARN.</p>"},{"location":"step1-eks-aurora-setup/#overview-of-what-were-creating","title":"Overview of What We're Creating","text":"Resource Purpose VPC with public/private subnets Network isolation for EKS and Aurora EKS cluster (1.33, Auto Mode) Runs the Plattr operator and app workloads OIDC provider Enables IRSA (IAM Roles for Service Accounts) Aurora PostgreSQL Serverless v2 Database backend for the operator Security group rule Allows EKS pods to connect to Aurora"},{"location":"step1-eks-aurora-setup/#deploy-with-cdk-recommended","title":"Deploy with CDK (Recommended)","text":"<p>The <code>PlattrInfraStack</code> provisions all of the above in a single <code>cdk deploy</code>.</p>"},{"location":"step1-eks-aurora-setup/#1-install-dependencies","title":"1. Install dependencies","text":"<pre><code>cd packages/cdk\nnpm install\n</code></pre>"},{"location":"step1-eks-aurora-setup/#2-bootstrap-cdk-first-time-only","title":"2. Bootstrap CDK (first time only)","text":"<p>If you haven't used CDK in this account/region before:</p> <pre><code>npx cdk bootstrap aws://ACCOUNT_ID/ca-central-1\n</code></pre>"},{"location":"step1-eks-aurora-setup/#3-deploy-the-infrastructure-stack","title":"3. Deploy the infrastructure stack","text":"<pre><code>npx cdk deploy PlattrInfraStack \\\n  -c useInfraStack=true \\\n  -c account=YOUR_ACCOUNT_ID \\\n  -c region=ca-central-1\n</code></pre> <p>This takes 20-30 minutes (EKS cluster creation is the bottleneck).</p>"},{"location":"step1-eks-aurora-setup/#optional-context-overrides","title":"Optional context overrides","text":"Context key Default Description <code>eksClusterName</code> <code>plattr-nonprod</code> EKS cluster name <code>auroraMinCapacity</code> <code>0.5</code> Aurora Serverless v2 min ACU <code>auroraMaxCapacity</code> <code>4</code> Aurora Serverless v2 max ACU <p>EKS Auto Mode manages compute automatically \u2014 no instance types or node counts to configure.</p> <p>Example with overrides:</p> <pre><code>npx cdk deploy PlattrInfraStack \\\n  -c useInfraStack=true \\\n  -c account=123456789012 \\\n  -c region=us-east-1 \\\n  -c eksClusterName=plattr-dev \\\n  -c auroraMinCapacity=0.5 \\\n  -c auroraMaxCapacity=2\n</code></pre>"},{"location":"step1-eks-aurora-setup/#4-verify-the-cluster","title":"4. Verify the cluster","text":"<pre><code># Update kubeconfig (use the kubectl role ARN from stack outputs)\naws eks update-kubeconfig \\\n  --name plattr-nonprod \\\n  --region ca-central-1 \\\n  --role-arn &lt;KubectlRoleArn from stack output&gt;\n\nkubectl get nodes\n</code></pre> <p>You should see nodes provisioned by EKS Auto Mode in <code>Ready</code> state.</p>"},{"location":"step1-eks-aurora-setup/#5-test-aurora-connectivity","title":"5. Test Aurora connectivity","text":"<pre><code># Get the Aurora endpoint from stack outputs\nAURORA_ENDPOINT=$(aws cloudformation describe-stacks \\\n  --stack-name PlattrInfraStack \\\n  --query \"Stacks[0].Outputs[?OutputKey=='AuroraEndpoint'].OutputValue\" \\\n  --output text)\n\n# Get the admin password from Secrets Manager\nDB_PASSWORD=$(aws secretsmanager get-secret-value \\\n  --secret-id plattr/aurora-admin \\\n  --query \"SecretString\" --output text | jq -r '.password')\n\n# Test from inside the cluster\nkubectl run pg-test --rm -it --restart=Never \\\n  --image=postgres:16 \\\n  --env=\"PGPASSWORD=$DB_PASSWORD\" \\\n  -- psql -h $AURORA_ENDPOINT -U plattr_admin -d plattr -c \"SELECT version();\"\n</code></pre> <p>You should see the PostgreSQL 16 version string.</p>"},{"location":"step1-eks-aurora-setup/#6-deploy-the-operator-stack","title":"6. Deploy the operator stack","text":"<p>With <code>useInfraStack=true</code>, the operator stack automatically picks up the infra stack outputs \u2014 no manual <code>-c</code> args needed for cluster/Aurora values:</p> <pre><code>npx cdk deploy PlattrOperatorStack \\\n  -c useInfraStack=true \\\n  -c account=YOUR_ACCOUNT_ID \\\n  -c region=ca-central-1 \\\n  -c baseDomain=nonprod.yourcompany.dev \\\n  -c hostedZoneId=Z0123456789\n</code></pre>"},{"location":"step1-eks-aurora-setup/#cost-estimate-non-prod","title":"Cost Estimate (Non-Prod)","text":"Resource Approximate Monthly Cost EKS control plane + Auto Mode ~$73 Auto Mode compute (scales with workload) varies Aurora Serverless v2 (0.5 ACU min) ~$44 NAT Gateway ~$32 Total (idle) ~$150/month <p>With Auto Mode, compute scales to zero when no workloads are running. Set Aurora min capacity to 0 to further reduce idle costs.</p>"},{"location":"step1-eks-aurora-setup/#whats-next","title":"What's Next","text":"<p>Once you've verified everything, proceed to Step 2: Deploy the CDK Operator Stack.</p> <p>You'll need a Route 53 hosted zone for your base domain (e.g., <code>nonprod.yourcompany.dev</code>). If you don't have one, create it:</p> <pre><code>aws route53 create-hosted-zone \\\n  --name nonprod.yourcompany.dev \\\n  --caller-reference \"plattr-$(date +%s)\"\n</code></pre> <p>Then add the NS records to your parent domain's DNS.</p>"},{"location":"step1-eks-aurora-setup/#appendix-a-manual-setup-alternative","title":"Appendix A: Manual Setup (Alternative)","text":"<p>If you prefer manual CLI commands or have existing infrastructure, follow the steps below instead of the CDK approach above.</p>"},{"location":"step1-eks-aurora-setup/#a1-define-your-variables","title":"A1. Define your variables","text":"<pre><code>export AWS_REGION=\"ca-central-1\"\nexport CLUSTER_NAME=\"plattr-nonprod\"\nexport ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)\n</code></pre>"},{"location":"step1-eks-aurora-setup/#a2-create-the-eks-cluster-with-eksctl","title":"A2. Create the EKS cluster with eksctl","text":"<pre><code>eksctl create cluster \\\n  --name $CLUSTER_NAME \\\n  --region $AWS_REGION \\\n  --version 1.33 \\\n  --without-nodegroup \\\n  --with-oidc\n\n# Enable Auto Mode\naws eks update-cluster-config \\\n  --name $CLUSTER_NAME \\\n  --region $AWS_REGION \\\n  --compute-config enabled=true,nodePools=system,general-purpose \\\n  --kubernetes-network-config '{\"elasticLoadBalancing\":{\"enabled\":true}}' \\\n  --storage-config '{\"blockStorage\":{\"enabled\":true}}'\n</code></pre> <p>This takes 15-20 minutes. The <code>--with-oidc</code> flag is critical \u2014 it enables IRSA which the operator stack requires. Auto Mode manages compute automatically.</p>"},{"location":"step1-eks-aurora-setup/#a3-verify-the-cluster","title":"A3. Verify the cluster","text":"<pre><code>kubectl get nodes\n</code></pre> <p>You should see nodes provisioned by EKS Auto Mode once workloads are scheduled.</p>"},{"location":"step1-eks-aurora-setup/#a4-collect-the-cluster-outputs","title":"A4. Collect the cluster outputs","text":"<pre><code>echo \"Cluster Name: $CLUSTER_NAME\"\n\n# OIDC Provider ARN\nexport OIDC_PROVIDER_ARN=$(aws iam list-open-id-connect-providers \\\n  --query \"OpenIDConnectProviderList[?ends_with(Arn, '$(aws eks describe-cluster \\\n    --name $CLUSTER_NAME \\\n    --region $AWS_REGION \\\n    --query \"cluster.identity.oidc.issuer\" \\\n    --output text | awk -F'/' '{print $NF}')')].[Arn]\" \\\n  --output text)\necho \"OIDC Provider ARN: $OIDC_PROVIDER_ARN\"\n\n# kubectl Role ARN\nexport KUBECTL_ROLE_ARN=$(aws cloudformation describe-stacks \\\n  --stack-name eksctl-${CLUSTER_NAME}-cluster \\\n  --region $AWS_REGION \\\n  --query \"Stacks[0].Outputs[?OutputKey=='ARN'].OutputValue\" \\\n  --output text 2&gt;/dev/null)\nif [ -z \"$KUBECTL_ROLE_ARN\" ]; then\n  export KUBECTL_ROLE_ARN=$(aws sts get-caller-identity --query Arn --output text)\nfi\necho \"kubectl Role ARN: $KUBECTL_ROLE_ARN\"\n</code></pre>"},{"location":"step1-eks-aurora-setup/#a5-get-vpc-and-subnet-ids","title":"A5. Get VPC and subnet IDs","text":"<pre><code>export VPC_ID=$(aws eks describe-cluster \\\n  --name $CLUSTER_NAME \\\n  --region $AWS_REGION \\\n  --query \"cluster.resourcesVpcConfig.vpcId\" \\\n  --output text)\n\nexport PRIVATE_SUBNETS=$(aws ec2 describe-subnets \\\n  --filters \"Name=vpc-id,Values=$VPC_ID\" \"Name=tag:aws:cloudformation:logical-id,Values=SubnetPrivate*\" \\\n  --query \"Subnets[*].SubnetId\" \\\n  --output text)\n\nexport NODE_SG=$(aws eks describe-cluster \\\n  --name $CLUSTER_NAME \\\n  --region $AWS_REGION \\\n  --query \"cluster.resourcesVpcConfig.clusterSecurityGroupId\" \\\n  --output text)\n</code></pre>"},{"location":"step1-eks-aurora-setup/#a6-create-aurora-postgresql","title":"A6. Create Aurora PostgreSQL","text":"<pre><code># DB subnet group\nSUBNET_LIST=$(echo $PRIVATE_SUBNETS | tr '\\t' ' ')\naws rds create-db-subnet-group \\\n  --db-subnet-group-name plattr-nonprod-db \\\n  --db-subnet-group-description \"Plattr non-prod Aurora subnets\" \\\n  --subnet-ids $SUBNET_LIST \\\n  --region $AWS_REGION\n\n# Security group\nexport AURORA_SG=$(aws ec2 create-security-group \\\n  --group-name plattr-aurora-sg \\\n  --description \"Plattr Aurora PostgreSQL\" \\\n  --vpc-id $VPC_ID \\\n  --region $AWS_REGION \\\n  --query \"GroupId\" \\\n  --output text)\n\n# Allow EKS \u2192 Aurora on port 5432\naws ec2 authorize-security-group-ingress \\\n  --group-id $AURORA_SG \\\n  --protocol tcp \\\n  --port 5432 \\\n  --source-group $NODE_SG \\\n  --region $AWS_REGION\n\n# Generate password\nexport DB_PASSWORD=$(openssl rand -base64 24 | tr -dc 'a-zA-Z0-9' | head -c 32)\necho \"SAVE THIS PASSWORD: $DB_PASSWORD\"\n\n# Create Aurora cluster\naws rds create-db-cluster \\\n  --db-cluster-identifier plattr-nonprod \\\n  --engine aurora-postgresql \\\n  --engine-version 16.4 \\\n  --master-username plattr_admin \\\n  --master-user-password \"$DB_PASSWORD\" \\\n  --db-subnet-group-name plattr-nonprod-db \\\n  --vpc-security-group-ids $AURORA_SG \\\n  --serverless-v2-scaling-configuration MinCapacity=0.5,MaxCapacity=4 \\\n  --region $AWS_REGION\n\n# Create instance\naws rds create-db-instance \\\n  --db-instance-identifier plattr-nonprod-instance-1 \\\n  --db-cluster-identifier plattr-nonprod \\\n  --db-instance-class db.serverless \\\n  --engine aurora-postgresql \\\n  --region $AWS_REGION\n\n# Wait for it\naws rds wait db-instance-available \\\n  --db-instance-identifier plattr-nonprod-instance-1 \\\n  --region $AWS_REGION\n\n# Get endpoint\nexport AURORA_ENDPOINT=$(aws rds describe-db-clusters \\\n  --db-cluster-identifier plattr-nonprod \\\n  --region $AWS_REGION \\\n  --query \"DBClusters[0].Endpoint\" \\\n  --output text)\n\n# Create the plattr database\nkubectl run pg-setup --rm -it --restart=Never \\\n  --image=postgres:16 \\\n  --env=\"PGPASSWORD=$DB_PASSWORD\" \\\n  -- psql -h $AURORA_ENDPOINT -U plattr_admin -d postgres -c \"CREATE DATABASE plattr;\"\n</code></pre>"},{"location":"step1-eks-aurora-setup/#a7-deploy-operator-stack-with-manual-context-args","title":"A7. Deploy operator stack with manual context args","text":"<pre><code>cd packages/cdk\nnpx cdk deploy PlattrOperatorStack \\\n  -c eksClusterName=$CLUSTER_NAME \\\n  -c kubectlRoleArn=$KUBECTL_ROLE_ARN \\\n  -c oidcProviderArn=$OIDC_PROVIDER_ARN \\\n  -c auroraEndpoint=$AURORA_ENDPOINT \\\n  -c auroraSgId=$AURORA_SG \\\n  -c baseDomain=nonprod.yourcompany.dev \\\n  -c hostedZoneId=Z0123456789\n</code></pre>"},{"location":"step1-eks-aurora-setup/#appendix-b-creating-a-dedicated-kubectl-iam-role","title":"Appendix B: Creating a Dedicated kubectl IAM Role","text":"<p>If you want a dedicated role instead of using your current identity:</p> <pre><code>TRUST_POLICY=$(cat &lt;&lt;EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [{\n    \"Effect\": \"Allow\",\n    \"Principal\": { \"AWS\": \"arn:aws:iam::${ACCOUNT_ID}:root\" },\n    \"Action\": \"sts:AssumeRole\"\n  }]\n}\nEOF\n)\n\naws iam create-role \\\n  --role-name plattr-kubectl-role \\\n  --assume-role-policy-document \"$TRUST_POLICY\"\n\naws iam attach-role-policy \\\n  --role-name plattr-kubectl-role \\\n  --policy-arn arn:aws:iam::aws:policy/AmazonEKSClusterPolicy\n\neksctl create iamidentitymapping \\\n  --cluster $CLUSTER_NAME \\\n  --region $AWS_REGION \\\n  --arn arn:aws:iam::${ACCOUNT_ID}:role/plattr-kubectl-role \\\n  --group system:masters \\\n  --username plattr-admin\n\nexport KUBECTL_ROLE_ARN=\"arn:aws:iam::${ACCOUNT_ID}:role/plattr-kubectl-role\"\n</code></pre>"},{"location":"step2-prod-account-setup/","title":"Step 2: Production Account Setup","text":"<p>This guide walks through setting up Plattr's production environment in a dedicated AWS account with managed services.</p>"},{"location":"step2-prod-account-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>A separate AWS account for production</li> <li>AWS CLI profiles configured for both accounts</li> <li>CDK bootstrapped in the prod account</li> <li>Non-prod environment already running (see Developer Guide)</li> </ul>"},{"location":"step2-prod-account-setup/#architecture","title":"Architecture","text":"<p>Production runs on its own EKS cluster with AWS managed services instead of containerized equivalents:</p> Service Non-Prod Production Database Shared Aurora (schema-per-app) Dedicated Aurora Serverless v2 Redis Redis pod in plattr-system ElastiCache Serverless (Redis 7) Search OpenSearch pod in plattr-system OpenSearch Service (managed) Storage S3 S3 Auth Keycloak on EKS Keycloak on EKS <p>The operator auto-detects its mode via environment variables: if <code>REDIS_ENDPOINT</code> and <code>OPENSEARCH_ENDPOINT</code> are set, it runs in managed mode and creates ConfigMaps pointing to the AWS services. Otherwise, it runs in container mode and points to in-cluster pods.</p>"},{"location":"step2-prod-account-setup/#step-1-bootstrap-the-prod-account","title":"Step 1: Bootstrap the Prod Account","text":"<pre><code># Switch to prod account credentials\nexport AWS_PROFILE=plattr-prod\n\n# Bootstrap CDK\nnpx cdk bootstrap aws://PROD_ACCOUNT_ID/ca-central-1\n</code></pre>"},{"location":"step2-prod-account-setup/#step-2-deploy-production-infrastructure","title":"Step 2: Deploy Production Infrastructure","text":"<p>From <code>packages/cdk</code>:</p> <pre><code>cd packages/cdk\n\n# Deploy infra + operator\nnpx cdk deploy PlattrProdInfraStack PlattrProdOperatorStack \\\n  -c target=prod \\\n  -c account=PROD_ACCOUNT_ID \\\n  -c region=ca-central-1 \\\n  -c baseDomain=prod.yourcompany.dev \\\n  -c hostedZoneId=Z_PROD_HOSTED_ZONE_ID \\\n  -c nonprodAccountId=NONPROD_ACCOUNT_ID\n</code></pre> <p>This creates: - VPC with public/private subnets (2 AZs, 1 NAT) - EKS cluster <code>plattr-prod</code> (Auto Mode, compute fully managed by EKS) - Aurora Serverless v2 (PostgreSQL 16.4, 1-8 ACU) - ElastiCache Serverless (Redis 7, <code>plattr-prod-redis</code>) - OpenSearch Service domain (<code>plattr-prod-search</code>, 2x t3.medium.search) - Security groups: EKS \u2192 Aurora:5432, EKS \u2192 ElastiCache:6379, EKS \u2192 OpenSearch:443 - Cross-account ECR pull role for pulling images from non-prod - Operator Helm chart with <code>REDIS_ENDPOINT</code> and <code>OPENSEARCH_ENDPOINT</code> configured - production namespace only (no staging/uat/preview)</p>"},{"location":"step2-prod-account-setup/#customizing-prod-resources","title":"Customizing Prod Resources","text":"Context key Default Description <code>eksClusterName</code> <code>plattr-prod</code> EKS cluster name <code>auroraMinCapacity</code> <code>1</code> Aurora min ACU <code>auroraMaxCapacity</code> <code>8</code> Aurora max ACU <code>opensearchInstanceType</code> <code>t3.medium.search</code> OpenSearch instance type <code>opensearchDataNodeCount</code> <code>2</code> OpenSearch data node count"},{"location":"step2-prod-account-setup/#step-3-set-up-cross-account-ecr-access","title":"Step 3: Set Up Cross-Account ECR Access","text":"<p>The prod account needs to pull container images from the non-prod ECR. The <code>PlattrProdInfraStack</code> creates the pull role automatically when <code>nonprodAccountId</code> is provided.</p> <p>On the non-prod side, update the ECR repository policy to allow cross-account access:</p> <pre><code># Switch to non-prod account\nexport AWS_PROFILE=plattr-nonprod\n\n# Add cross-account pull policy to ECR repos\naws ecr set-repository-policy \\\n  --repository-name plattr-apps \\\n  --policy-text '{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [{\n      \"Sid\": \"AllowProdAccountPull\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\"AWS\": \"arn:aws:iam::PROD_ACCOUNT_ID:root\"},\n      \"Action\": [\n        \"ecr:GetDownloadUrlForLayer\",\n        \"ecr:BatchGetImage\",\n        \"ecr:BatchCheckLayerAvailability\"\n      ]\n    }]\n  }'\n</code></pre> <p>Repeat for <code>plattr-operator</code> if deploying the operator image from non-prod ECR.</p>"},{"location":"step2-prod-account-setup/#step-4-configure-cicd-cross-account-deploy","title":"Step 4: Configure CI/CD Cross-Account Deploy","text":"<p>Update the CI/CD stack in the non-prod account with the prod account ID:</p> <pre><code>export AWS_PROFILE=plattr-nonprod\ncd packages/cdk\n\nnpx cdk deploy PlattrCicdStack \\\n  -c githubOrg=your-org \\\n  -c prodAccountId=PROD_ACCOUNT_ID\n</code></pre> <p>This grants the <code>plattr-ci-deploy-prod</code> role permission to <code>sts:AssumeRole</code> into the prod account.</p>"},{"location":"step2-prod-account-setup/#github-secrets","title":"GitHub Secrets","text":"<p>Add these secrets to your GitHub repository:</p> Secret Value <code>AWS_ROLE_ARN</code> Non-prod CI deploy role ARN <code>AWS_ROLE_ARN_PROD</code> Prod CI deploy role ARN"},{"location":"step2-prod-account-setup/#step-5-verify-the-deployment","title":"Step 5: Verify the Deployment","text":"<pre><code># Switch to prod account\nexport AWS_PROFILE=plattr-prod\n\n# Check EKS cluster\naws eks describe-cluster --name plattr-prod --query 'cluster.status'\n\n# Configure kubectl\naws eks update-kubeconfig --name plattr-prod\n\n# Verify operator is running\nkubectl get pods -n plattr-system\n\n# Check operator logs\nkubectl logs -n plattr-system -l app.kubernetes.io/name=plattr-operator\n\n# Verify managed service endpoints are configured\nkubectl get deployment plattr-operator -n plattr-system -o jsonpath='{.spec.template.spec.containers[0].env}' | python3 -m json.tool\n\n# Check production namespace exists\nkubectl get ns production\n</code></pre>"},{"location":"step2-prod-account-setup/#step-6-test-a-production-deploy","title":"Step 6: Test a Production Deploy","text":"<p>Merge a PR to <code>main</code>. The GitHub Actions workflow will:</p> <ol> <li>Build and push the image to ECR (non-prod account)</li> <li>Deploy to staging \u2192 UAT (non-prod EKS)</li> <li>After UAT approval, assume the prod deploy role</li> <li>Apply the Application CR to the prod EKS cluster's <code>production</code> namespace</li> <li>The prod operator reconciles using managed services</li> </ol> <p>Check the deployment:</p> <pre><code>kubectl get applications -n production\nkubectl get application my-app -n production -o yaml\n</code></pre>"},{"location":"step2-prod-account-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"step2-prod-account-setup/#operator-cant-reach-elasticacheopensearch","title":"Operator Can't Reach ElastiCache/OpenSearch","text":"<p>Check security group rules allow EKS cluster SG \u2192 service port:</p> <pre><code># ElastiCache (port 6379)\naws ec2 describe-security-groups --group-ids &lt;elasticache-sg-id&gt; \\\n  --query 'SecurityGroups[0].IpPermissions'\n\n# OpenSearch (port 443)\naws ec2 describe-security-groups --group-ids &lt;opensearch-sg-id&gt; \\\n  --query 'SecurityGroups[0].IpPermissions'\n</code></pre>"},{"location":"step2-prod-account-setup/#cross-account-ecr-pull-fails","title":"Cross-Account ECR Pull Fails","text":"<p>Verify the ECR repository policy and the pull role:</p> <pre><code># On non-prod\naws ecr get-repository-policy --repository-name plattr-apps\n\n# On prod \u2014 test pull\naws ecr get-login-password --region ca-central-1 | docker login --username AWS --password-stdin NONPROD_ACCOUNT_ID.dkr.ecr.ca-central-1.amazonaws.com\n</code></pre>"},{"location":"step2-prod-account-setup/#configmap-not-created","title":"ConfigMap Not Created","text":"<p>Check operator logs for <code>[REDIS]</code> or <code>[SEARCH]</code> entries:</p> <pre><code>kubectl logs -n plattr-system -l app.kubernetes.io/name=plattr-operator | grep -E '\\[REDIS\\]|\\[SEARCH\\]'\n</code></pre> <p>Verify environment variables are set:</p> <pre><code>kubectl exec -n plattr-system deploy/plattr-operator -- env | grep -E 'REDIS_ENDPOINT|OPENSEARCH_ENDPOINT'\n</code></pre>"},{"location":"tutorial/","title":"End-to-End Tutorial","text":"<p>This tutorial walks through a complete Plattr workflow from scratch. A platform engineer sets up a non-prod cluster on AWS, then a developer builds a Next.js app and deploys it.</p> <p>Conventions used throughout:</p> Placeholder Example value AWS Account ID <code>111122223333</code> AWS Region <code>us-east-1</code> Base domain <code>platform.example.dev</code> Route 53 Hosted Zone ID <code>Z0EXAMPLE12345</code> GitHub org <code>acme-eng</code> App name <code>my-app</code>"},{"location":"tutorial/#part-1-platform-engineer-setting-up-the-cluster","title":"Part 1: Platform Engineer \u2014 Setting Up the Cluster","text":""},{"location":"tutorial/#11-prerequisites","title":"1.1 Prerequisites","text":"<p>Install the following before proceeding:</p> Tool Version Purpose Node.js 18+ Runs CDK and CLI Docker Latest Container builds, Kind cluster AWS CLI v2 AWS authentication AWS CDK v2 Infrastructure deployment kubectl 1.28+ Kubernetes interaction Helm v3 Chart installations <p>Ensure your AWS CLI is configured with credentials that have administrator access:</p> <pre><code>aws sts get-caller-identity\n# Should return your account ID (e.g. 111122223333)\n</code></pre>"},{"location":"tutorial/#12-dns-setup","title":"1.2 DNS Setup","text":"<p>Create a Route 53 hosted zone for your base domain. Apps will be accessible at <code>{appName}.{env}.{baseDomain}</code> (e.g. <code>my-app.staging.platform.example.dev</code>).</p> <ol> <li>In the AWS Console, go to Route 53 \u2192 Hosted zones \u2192 Create hosted zone</li> <li>Enter your domain (e.g. <code>platform.example.dev</code>) and select Public hosted zone</li> <li>Copy the NS records and add them to your domain registrar</li> <li>Note the Hosted Zone ID (e.g. <code>Z0EXAMPLE12345</code>) \u2014 you'll need it later</li> </ol> <p>Verify DNS delegation is working:</p> <pre><code>dig NS platform.example.dev\n# Should return the Route 53 NS records\n</code></pre>"},{"location":"tutorial/#13-clone-and-install","title":"1.3 Clone and Install","text":"<pre><code>git clone https://github.com/acme-eng/plattr.git\ncd plattr\nnpm install\n</code></pre>"},{"location":"tutorial/#14-initialize-infrastructure-configuration","title":"1.4 Initialize Infrastructure Configuration","text":"<p>Run the interactive wizard to generate <code>packages/cdk/cdk.json</code>:</p> <pre><code>plattr infra init\n</code></pre> <p>Walk through each prompt:</p> <p>Environment type:</p> <pre><code>? Environment type: Non-prod (staging/dev)\n</code></pre> <p>Choose <code>Non-prod (staging/dev)</code> \u2014 this creates staging and UAT environments on a single EKS cluster.</p> <p>Common settings:</p> <pre><code>? AWS Account ID?  111122223333\n? AWS Region?      us-east-1\n? Base domain?     platform.example.dev\n? Route 53 Hosted Zone ID?  Z0EXAMPLE12345\n? GitHub organization name?  acme-eng\n? GitHub repo filter?  (press Enter to skip)\n</code></pre> <p>The GitHub org is used for OIDC federation \u2014 CI/CD workflows in repos under this org can authenticate to AWS without static credentials. The repo filter is optional; leave it blank to allow all repos in the org.</p> <p>Add-ons:</p> <pre><code>? Install cert-manager?    Yes\n? Install external-dns?    Yes\n? Install ingress-nginx?   Yes\n? Install Keycloak?        Yes\n</code></pre> <p>All default to <code>Yes</code>. These provide TLS certificates (Let's Encrypt), automatic DNS records, an ingress controller, and authentication respectively.</p> <p>Infrastructure mode:</p> <pre><code>? Infrastructure mode: CDK-managed (new VPC + EKS + Aurora)\n</code></pre> <p>Choose <code>CDK-managed</code> to have CDK create the VPC, EKS cluster, and Aurora database for you. The <code>Existing infrastructure</code> option is for connecting to an EKS cluster you already have.</p> <p>Cluster settings:</p> <pre><code>? EKS cluster name?         plattr-nonprod\n? Availability zones?       (press Enter for auto)\n? Aurora min ACU?           0.5\n? Aurora max ACU?           4\n</code></pre> <p>EKS Auto Mode handles compute automatically \u2014 no instance types or node counts to configure. For a tutorial or dev/test environment, Aurora Serverless at 0.5\u20134 ACUs keeps costs low.</p> <p>The wizard writes <code>packages/cdk/cdk.json</code> and prints next steps:</p> <pre><code>Wrote packages/cdk/cdk.json\n\nNext steps:\n  cd packages/cdk\n  npm install\n  npx cdk bootstrap aws://111122223333/us-east-1\n  npx cdk deploy PlattrInfraStack PlattrOperatorStack PlattrCicdStack\n</code></pre>"},{"location":"tutorial/#15-bootstrap-cdk","title":"1.5 Bootstrap CDK","text":"<p>CDK bootstrap creates a staging S3 bucket and IAM roles that CDK uses to deploy resources:</p> <pre><code>cd packages/cdk\nnpx cdk bootstrap aws://111122223333/us-east-1\n</code></pre> <p>This only needs to run once per account/region combination.</p>"},{"location":"tutorial/#16-deploy-the-stacks","title":"1.6 Deploy the Stacks","text":"<p>Deploy all three stacks:</p> <pre><code>npx cdk deploy PlattrInfraStack PlattrOperatorStack PlattrCicdStack\n</code></pre> <p>CDK will show you the resources it plans to create and ask for confirmation. Type <code>y</code> to proceed.</p> <p>What gets created (~30\u201345 minutes):</p> Stack What it creates <code>PlattrInfraStack</code> VPC (public/private subnets, NAT gateway), EKS cluster (Kubernetes 1.33, Auto Mode), Aurora Serverless v2 (PostgreSQL 16.4) <code>PlattrOperatorStack</code> <code>plattr-system</code> namespace, CRDs (<code>Application</code>, <code>PreviewEnvironment</code>), operator Helm release, ECR repo (<code>plattr-operator</code>), IRSA role, environment namespaces (<code>staging</code>, <code>uat</code>, <code>production</code>), cert-manager + Let's Encrypt, external-dns, ingress-nginx (AWS NLB), Keycloak <code>PlattrCicdStack</code> GitHub OIDC provider, ECR repo (<code>plattr-apps</code>), CI/CD deploy IAM roles"},{"location":"tutorial/#17-verify-the-cluster","title":"1.7 Verify the Cluster","text":"<p>Update your kubeconfig to point at the new cluster:</p> <pre><code>aws eks update-kubeconfig --name plattr-nonprod --region us-east-1\n</code></pre> <p>Check that nodes are ready:</p> <pre><code>kubectl get nodes\n# NAME                          STATUS   ROLES    AGE   VERSION\n# ip-10-0-1-xx.ec2.internal    Ready    &lt;none&gt;   10m   v1.33.x\n# ip-10-0-2-xx.ec2.internal    Ready    &lt;none&gt;   10m   v1.33.x\n</code></pre> <p>Check the operator is running:</p> <pre><code>kubectl get pods -n plattr-system\n# NAME                               READY   STATUS    RESTARTS   AGE\n# plattr-operator-xxxxxxxxxx-xxxxx   1/1     Running   0          5m\n</code></pre> <p>Check environment namespaces exist:</p> <pre><code>kubectl get ns staging uat production\n# NAME         STATUS   AGE\n# staging      Active   5m\n# uat          Active   5m\n# production   Active   5m\n</code></pre> <p>Check add-ons:</p> <pre><code>kubectl get pods -n cert-manager\nkubectl get pods -n ingress-nginx\nkubectl get pods -n external-dns\nkubectl get pods -n keycloak\n</code></pre> <p>Your cluster is ready. Developers can now deploy apps to it.</p>"},{"location":"tutorial/#18-tear-down-when-done","title":"1.8 Tear Down (When Done)","text":"<p>To remove all AWS resources when you're finished with this tutorial:</p> <pre><code>cd packages/cdk\nnpx cdk destroy --all\n</code></pre> <p>This deletes the EKS cluster, VPC, Aurora database, and all associated resources. Aurora has a <code>RETAIN</code> removal policy, so the database cluster will be retained as a safety measure \u2014 delete it manually from the RDS console if you want a full cleanup.</p>"},{"location":"tutorial/#part-2-developer-building-and-deploying-a-nextjs-app","title":"Part 2: Developer \u2014 Building and Deploying a Next.js App","text":""},{"location":"tutorial/#21-prerequisites","title":"2.1 Prerequisites","text":"Tool Version Purpose Node.js 18+ Runtime Docker Latest Container builds, local cluster Kind Latest Local Kubernetes kubectl 1.28+ Kubernetes interaction Dagger CLI Latest Build pipeline Plattr CLI Latest <code>npm install -g @plattr/cli</code>"},{"location":"tutorial/#22-scaffold-the-app","title":"2.2 Scaffold the App","text":"<p>Create a new Next.js app and initialize Plattr:</p> <pre><code>npx create-next-app@latest my-app\ncd my-app\nplattr init\n</code></pre> <p><code>plattr init</code> asks a series of questions:</p> <pre><code>? App name?        my-app\n? Framework?       nextjs\n? Enable database? Yes\n? Enable storage?  Yes\n? Enable auth?     Yes\n? Enable Redis?    No\n? Enable OpenSearch? No\n</code></pre> <p>This creates two files:</p> <ul> <li><code>plattr.yaml</code> \u2014 declares what your app needs:</li> </ul> <pre><code>name: my-app\nframework: nextjs\n\ndatabase:\n  enabled: true\n\nstorage:\n  enabled: true\n  buckets:\n    - name: uploads\n      public: false\n\nauth:\n  enabled: true\n  providers:\n    - google\n    - github\n\nlocal:\n  port: 3000\n</code></pre> <ul> <li><code>.github/workflows/plattr-deploy.yml</code> \u2014 CI/CD workflow for automatic deployment on push</li> </ul>"},{"location":"tutorial/#23-start-local-development","title":"2.3 Start Local Development","text":"<p>Start the local infrastructure:</p> <pre><code>plattr dev\n</code></pre> <p>This creates a Kind cluster, starts containerized services, and writes connection details to <code>.plattr/my-app.env</code>.</p> <p>Source the environment variables and start your dev server:</p> <pre><code>source .plattr/my-app.env\nnpx next dev\n</code></pre> <p>Your app is now running at <code>http://localhost:3000</code> with all backing services available.</p>"},{"location":"tutorial/#24-whats-running-locally","title":"2.4 What's Running Locally","text":"<p><code>plattr dev</code> starts these services in the Kind cluster and port-forwards them:</p> Service Port Description PostgreSQL 5432 App database (schema: <code>staging_my_app</code>) PostgREST 3001 Auto-generated REST API over your database MinIO 9000 (API), 9001 (Console) S3-compatible object storage Keycloak 8080 Authentication / identity provider Redis 6379 In-memory cache (if enabled) OpenSearch 9200 Search engine (if enabled) OpenSearch Dashboards 5601 Search UI (if enabled)"},{"location":"tutorial/#25-use-the-database","title":"2.5 Use the Database","text":"<p>Connect to the local database:</p> <pre><code>plattr db shell\n# Connects to PostgreSQL as the admin user\n</code></pre> <p>Create a migration. For example, using Prisma:</p> <pre><code>npx prisma init\n</code></pre> <p>Edit <code>prisma/schema.prisma</code>:</p> <pre><code>datasource db {\n  provider = \"postgresql\"\n  url      = env(\"DATABASE_URL\")\n}\n\ngenerator client {\n  provider = \"prisma-client-js\"\n}\n\nmodel Task {\n  id        Int      @id @default(autoincrement())\n  title     String\n  done      Boolean  @default(false)\n  createdAt DateTime @default(now())\n}\n</code></pre> <p>Run the migration:</p> <pre><code>plattr db migrate --engine prisma\n</code></pre> <p>The <code>Task</code> table is now available through PostgREST at <code>http://localhost:3001/task</code>:</p> <pre><code># Create a task\ncurl -X POST http://localhost:3001/task \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"title\": \"Try Plattr\", \"done\": false}'\n\n# List tasks\ncurl http://localhost:3001/task\n</code></pre> <p>In production, PostgREST runs as a sidecar container and is accessible at <code>/api/rest</code> on your app's domain.</p>"},{"location":"tutorial/#26-run-tests","title":"2.6 Run Tests","text":"<p>Plattr auto-detects your test runner (Vitest, Jest, RSpec, or Minitest):</p> <pre><code>plattr test\n</code></pre> <p>For CI-style ephemeral tests (runs in a Dagger container):</p> <pre><code>plattr test --ci\n</code></pre>"},{"location":"tutorial/#27-full-local-pipeline","title":"2.7 Full Local Pipeline","text":"<p>Build, scan, and deploy to your local Kind cluster:</p> <pre><code>plattr deploy local\n</code></pre> <p>This runs through the full pipeline:</p> <ol> <li>Test \u2014 runs your test suite</li> <li>Build \u2014 creates a production container image</li> <li>Push \u2014 pushes to the local Kind registry</li> <li>Scan \u2014 runs Trivy vulnerability scan</li> <li>Deploy \u2014 applies Kubernetes resources to the Kind cluster</li> </ol> <p>Skip steps with flags:</p> <pre><code>plattr deploy local --skip-tests --skip-scan\n</code></pre> <p>Once deployed, check your app's status:</p> <pre><code>plattr status\n# Phase: Running\n# Conditions:\n#   DatabaseReady:   True\n#   StorageReady:    True\n#   AuthReady:       True\n#   DeploymentReady: True\n#   IngressReady:    True\n</code></pre> <p>View logs (includes PostgREST sidecar output):</p> <pre><code>plattr logs -f\n</code></pre> <p>To remove the local deployment:</p> <pre><code>plattr undeploy local\n</code></pre>"},{"location":"tutorial/#28-deploy-to-the-cluster","title":"2.8 Deploy to the Cluster","text":"<p>With the CI/CD stack deployed (Part 1), pushing to GitHub triggers automatic deployment.</p> <p>Commit and push your app:</p> <pre><code>git init\ngit add .\ngit commit -m \"Initial commit\"\ngit remote add origin https://github.com/acme-eng/my-app.git\ngit push -u origin main\n</code></pre> <p>The <code>.github/workflows/plattr-deploy.yml</code> workflow runs automatically:</p> <ol> <li>Authenticates to AWS via GitHub OIDC (no static credentials)</li> <li>Builds a production container image</li> <li>Pushes to the <code>plattr-apps</code> ECR repository</li> <li>Runs Trivy security scan</li> <li>Applies the <code>Application</code> custom resource to the EKS cluster</li> <li>The operator reconciles: creates the database schema, S3 bucket, Keycloak client, Deployment, Service, and Ingress</li> </ol> <p>Deployments go to staging by default. Merges to <code>main</code> can be promoted to production.</p>"},{"location":"tutorial/#29-verify-the-deployment","title":"2.9 Verify the Deployment","text":"<p>Check the deployment status from the CLI:</p> <pre><code>plattr status --env staging\n</code></pre> <p>Or directly via kubectl:</p> <pre><code>kubectl get application my-app -n staging\n</code></pre> <p>Once all conditions are <code>True</code>, your app is live at:</p> <pre><code>https://my-app.staging.platform.example.dev\n</code></pre> <p>The auto-generated REST API is available at:</p> <pre><code>https://my-app.staging.platform.example.dev/api/rest\n</code></pre>"},{"location":"tutorial/#210-preview-environments","title":"2.10 Preview Environments","text":"<p>When a pull request is opened, Plattr creates a preview environment automatically. You can also create one locally:</p> <pre><code>plattr preview start --pr 42\n</code></pre> <p>Preview environments get their own:</p> <ul> <li>Database schema (<code>preview_my_app_pr_42</code>)</li> <li>S3 bucket prefix</li> <li>Keycloak client</li> <li>Ingress at <code>my-app-pr-42.staging.platform.example.dev</code></li> </ul> <p>List active previews:</p> <pre><code>plattr preview list\n</code></pre> <p>Preview environments are cleaned up automatically after 72 hours of inactivity.</p>"},{"location":"tutorial/#211-clean-up","title":"2.11 Clean Up","text":"<p>Local cleanup:</p> <pre><code>plattr infra destroy\n</code></pre> <p>This deletes the Kind cluster and the local Docker registry.</p> <p>AWS cleanup (from the Plattr repo):</p> <pre><code>cd packages/cdk\nnpx cdk destroy --all\n</code></pre>"},{"location":"tutorial/#summary","title":"Summary","text":"Step Command Who Initialize config <code>plattr infra init</code> Platform engineer Bootstrap CDK <code>npx cdk bootstrap aws://ACCOUNT/REGION</code> Platform engineer Deploy stacks <code>npx cdk deploy PlattrInfraStack PlattrOperatorStack PlattrCicdStack</code> Platform engineer Scaffold app <code>npx create-next-app@latest my-app &amp;&amp; plattr init</code> Developer Local dev <code>plattr dev</code> Developer Run tests <code>plattr test</code> Developer Local deploy <code>plattr deploy local</code> Developer Remote deploy <code>git push</code> (triggers CI/CD) Developer Tear down <code>npx cdk destroy --all</code> Platform engineer"},{"location":"tutorial/#next-steps","title":"Next Steps","text":"<ul> <li>Developer Guide \u2014 detailed reference for all developer workflows</li> <li>Plattr Team Guide \u2014 operating and troubleshooting the platform</li> <li>CLI Reference \u2014 complete command reference</li> <li>plattr.yaml Reference \u2014 all configuration options</li> <li>Architecture Deep-Dive \u2014 how Plattr works under the hood</li> </ul>"},{"location":"diagrams/infrastructure/","title":"Plattr Infrastructure Architecture","text":""},{"location":"diagrams/infrastructure/#two-account-architecture","title":"Two-Account Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Non-Prod Account (ca-central-1)                         \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                    VPC (public + private subnets, 2 AZs)                  \u2502  \u2502\n\u2502  \u2502                                                                           \u2502  \u2502\n\u2502  \u2502  \u250c\u2500 Public Subnets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   \u2502  NAT Gateway \u2502        \u2502  Network LB  \u2502\u25c4\u2500\u2500\u2500\u2500 internet traffic   \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502             \u2502                       \u2502                                     \u2502  \u2502\n\u2502  \u2502  \u250c\u2500 Private Subnets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                EKS Cluster: plattr-nonprod (K8s 1.33)        \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502              Auto Mode (system + general-purpose pools)      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502              OIDC Provider (for IRSA)                        \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                                                              \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 plattr-system ns \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502 Plattr Operator \u2502   \u2502 Keycloak (StatefulSet, 2r) \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502  (container     \u2502   \u2502   Auth provider (OIDC)     \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502   mode)         \u2502   \u2502   External PostgreSQL      \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502   IRSA role     \u2502   \u2502   HTTPS Ingress            \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502  PG    \u2502 \u2502MinIO \u2502 \u2502Redis\u2502 \u2502OpenSearch \u2502            \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502 :5432  \u2502 \u2502:9000 \u2502 \u2502:6379\u2502 \u2502  :9200   \u2502            \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502 cert-manager \u2502 \u2502 external-dns \u2502 \u2502 ingress-nginx \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                                                              \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500 staging ns \u2500\u2500\u2510  \u250c\u2500\u2500\u2500 uat ns \u2500\u2500\u2510                      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502 App Deployments  \u2502  \u2502 App Deploy. \u2502                      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502 + PostgREST      \u2502  \u2502 + PostgREST \u2502                      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                                                              \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500 preview-app-pr-* ns (dynamic, TTL-based) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  Isolated namespace per PR                             \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  Auto-cleanup after 72h (TTL controller)               \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502                              \u2502                                     \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502                              \u2502 port 5432 (containerized PG)        \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500 AWS Services \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502   \u2502\n\u2502  \u2502  \u2502    S3    \u2502  \u2502   ECR    \u2502  \u2502 Secrets Manager \u2502  \u2502 Route 53  \u2502       \u2502   \u2502\n\u2502  \u2502  \u2502          \u2502  \u2502 plattr-  \u2502  \u2502 plattr/db-admin \u2502  \u2502           \u2502       \u2502   \u2502\n\u2502  \u2502  \u2502 Bucket/  \u2502  \u2502  operator\u2502  \u2502                 \u2502  \u2502 *.nonprod \u2502       \u2502   \u2502\n\u2502  \u2502  \u2502 app/env  \u2502  \u2502 plattr-  \u2502  \u2502                 \u2502  \u2502 .company  \u2502       \u2502   \u2502\n\u2502  \u2502  \u2502          \u2502  \u2502  apps    \u2502  \u2502                 \u2502  \u2502  .dev     \u2502       \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500 IAM \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  GitHub OIDC Provider (keyless CI auth)                                    \u2502 \u2502\n\u2502  \u2502  CI Deploy Role  \u2014 any branch \u2192 ECR push + EKS describe (non-prod)        \u2502 \u2502\n\u2502  \u2502  Prod Deploy Role \u2014 main branch only \u2192 sts:AssumeRole into prod account   \u2502 \u2502\n\u2502  \u2502  Operator IRSA Role \u2014 S3 + Secrets Manager + STS                          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Prod Account (ca-central-1)                            \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                    VPC (public + private subnets, 2 AZs)                  \u2502  \u2502\n\u2502  \u2502                                                                           \u2502  \u2502\n\u2502  \u2502  \u250c\u2500 Public Subnets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   \u2502  NAT Gateway \u2502        \u2502  Network LB  \u2502\u25c4\u2500\u2500\u2500\u2500 internet traffic   \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502             \u2502                       \u2502                                     \u2502  \u2502\n\u2502  \u2502  \u250c\u2500 Private Subnets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                EKS Cluster: plattr-prod (K8s 1.33)           \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502              Auto Mode (system + general-purpose pools)      \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502              OIDC Provider (for IRSA)                        \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                                                              \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 plattr-system ns \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502 Plattr Operator \u2502   \u2502 Keycloak (StatefulSet, 2r) \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502  (managed mode) \u2502   \u2502   Auth provider (OIDC)     \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502  REDIS_ENDPOINT \u2502   \u2502   External PostgreSQL      \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502  OPENSEARCH_    \u2502   \u2502   HTTPS Ingress            \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502   ENDPOINT set  \u2502   \u2502                            \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2502 cert-manager \u2502 \u2502 external-dns \u2502 \u2502 ingress-nginx \u2502 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502                                                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  (No containerized PG/MinIO/Redis/OpenSearch pods)    \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                                                              \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500 production ns \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  App Deployments + PostgREST sidecar                   \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  Services, Ingress, HPA (2-20)                         \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2502  Resource Quotas (16 CPU, 32Gi)                        \u2502 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502             \u2502                  \u2502                   \u2502               \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502             \u2502 port 5432        \u2502 port 6379         \u2502 port 443     \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502             \u25bc                  \u25bc                   \u25bc               \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502 Aurora Serverless \u2502 \u2502 ElastiCache      \u2502 \u2502 OpenSearch Service\u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502 v2 (PG 16.4)     \u2502 \u2502 Serverless       \u2502 \u2502 plattr-prod-     \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502 1-8 ACU          \u2502 \u2502 (Redis 7)        \u2502 \u2502   search         \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502 plattr DB         \u2502 \u2502 plattr-prod-     \u2502 \u2502 t3.medium.search \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502                  \u2502 \u2502   redis           \u2502 \u2502 2 data nodes     \u2502 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500 AWS Services \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502   \u2502\n\u2502  \u2502  \u2502    S3    \u2502  \u2502 Secrets Manager   \u2502  \u2502 Route 53  \u2502                    \u2502   \u2502\n\u2502  \u2502  \u2502          \u2502  \u2502 plattr/aurora-    \u2502  \u2502           \u2502                    \u2502   \u2502\n\u2502  \u2502  \u2502 Bucket/  \u2502  \u2502   admin-prod      \u2502  \u2502 *.prod    \u2502                    \u2502   \u2502\n\u2502  \u2502  \u2502 app/env  \u2502  \u2502                   \u2502  \u2502 .company  \u2502                    \u2502   \u2502\n\u2502  \u2502  \u2502          \u2502  \u2502                   \u2502  \u2502  .dev     \u2502                    \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                                 \u2502\n\u2502  \u250c\u2500 IAM \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502  plattr-ci-deploy-prod \u2014 trusted by non-prod's Prod Deploy Role          \u2502 \u2502\n\u2502  \u2502  plattr-prod-ecr-pull \u2014 cross-account ECR pull from non-prod             \u2502 \u2502\n\u2502  \u2502  Operator IRSA Role \u2014 S3 + Secrets Manager + STS                          \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"diagrams/infrastructure/#cross-account-image-flow","title":"Cross-Account Image Flow","text":"<pre><code>Non-Prod Account                        Prod Account\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   ECR    \u2502    cross-account pull    \u2502  EKS (prod)      \u2502\n\u2502 plattr-  \u2502 \u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502  pulls images    \u2502\n\u2502  apps    \u2502    via ECR pull role     \u2502  for production   \u2502\n\u2502 plattr-  \u2502                          \u2502  deployments      \u2502\n\u2502  operator\u2502                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"diagrams/infrastructure/#dns-traffic-flow","title":"DNS &amp; Traffic Flow","text":"<pre><code>Internet\n   \u2502\n   \u25bc\n</code></pre> <p>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 Route 53\u2502\u2500\u2500\u2500\u25b6\u2502  Network LB   \u2502\u2500\u2500\u2500\u25b6\u2502  ingress-nginx (in EKS)         \u2502   \u2502         \u2502    \u2502  (public)     \u2502    \u2502                                  \u2502   \u2502 Records \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  Routing rules:                 \u2502   \u2502 managed \u2502                         \u2502  app.domain.dev      \u2192 app:80   \u2502   \u2502 by      \u2502                         \u2502  app.domain.dev/api/ \u2192 app:3001 \u2502   \u2502 external\u2502                         \u2502  app.stg.domain.dev  \u2192 app:80   \u2502   \u2502 -dns    \u2502                         \u2502  pr-N.app.preview.   \u2192 app:80   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                               \u2502                                               \u25bc                                       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                       \u2502 TLS terminated by \u2502                                       \u2502 cert-manager      \u2502                                       \u2502 (Let's Encrypt)   \u2502                                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p>"},{"location":"diagrams/infrastructure/#domain-pattern","title":"Domain Pattern","text":"<p>{app}.{baseDomain}                        \u2192 production (prod account)   {app}.staging.{baseDomain}                \u2192 staging (non-prod account)   {app}.uat.{baseDomain}                    \u2192 uat (non-prod account)   pr-{N}.{app}.preview.{baseDomain}         \u2192 preview (non-prod account)</p>"},{"location":"diagrams/infrastructure/#pod-architecture-per-app-with-database","title":"Pod Architecture (per app with database)","text":"<p>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502                    Pod                                \u2502   \u2502                                                       \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502   \u2502  \u2502  App Container   \u2502  \u2502 PostgREST Sidecar \u2502          \u2502   \u2502  \u2502  (from ECR)      \u2502  \u2502 v12.2.3           \u2502          \u2502   \u2502  \u2502  port: 3000      \u2502  \u2502 port: 3001        \u2502          \u2502   \u2502  \u2502                  \u2502  \u2502 50m CPU, 64Mi mem \u2502          \u2502   \u2502  \u2502  Env vars from:  \u2502  \u2502                   \u2502          \u2502   \u2502  \u2502  - {name}-db     \u2502  \u2502 Auto-reload via   \u2502          \u2502   \u2502  \u2502    (Secret)      \u2502  \u2502 LISTEN/NOTIFY     \u2502          \u2502   \u2502  \u2502  - {name}-storage\u2502  \u2502                   \u2502          \u2502   \u2502  \u2502    (ConfigMap)   \u2502  \u2502 Schema:           \u2502          \u2502   \u2502  \u2502  - {name}-auth   \u2502  \u2502 {env}_{app_name}  \u2502          \u2502   \u2502  \u2502    (ConfigMap)   \u2502  \u2502                   \u2502          \u2502   \u2502  \u2502  - {name}-redis  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502   \u2502  \u2502    (ConfigMap)   \u2502                                  \u2502   \u2502  \u2502  - {name}-search \u2502                                  \u2502   \u2502  \u2502    (ConfigMap)   \u2502                                  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p>"},{"location":"diagrams/infrastructure/#cdk-stack-breakdown","title":"CDK Stack Breakdown","text":"<p>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 Non-Prod: PlattrInfraStack                          \u2502   \u2502  VPC, EKS (plattr-nonprod), Aurora, OIDC, SGs       \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502 outputs: ClusterName, KubectlRoleArn,                          \u2502          OidcProviderArn, AuroraEndpoint                          \u25bc   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 Non-Prod: PlattrOperatorStack                       \u2502   \u2502  plattr-system ns, CRDs, IRSA, Helm chart,          \u2502   \u2502  cert-manager, external-dns, ingress-nginx,          \u2502   \u2502  Keycloak, env namespaces (staging+uat+production)   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p> <p>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 Prod: PlattrProdInfraStack                           \u2502   \u2502  VPC, EKS (plattr-prod), Aurora (1-8 ACU),          \u2502   \u2502  ElastiCache Serverless (Redis 7),                   \u2502   \u2502  OpenSearch Service (2-node), SGs, cross-acct ECR    \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502 outputs: + RedisEndpoint, OpenSearchEndpoint                          \u25bc   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 Prod: PlattrProdOperatorStack                        \u2502   \u2502  plattr-system ns, CRDs, IRSA, Helm chart,          \u2502   \u2502  cert-manager, external-dns, ingress-nginx,          \u2502   \u2502  Keycloak, production namespace only                 \u2502   \u2502  Operator env: REDIS_ENDPOINT, OPENSEARCH_ENDPOINT   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p> <p>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 PlattrCicdStack (non-prod account)                   \u2502   \u2502  GitHub OIDC provider, ECR (apps),                   \u2502   \u2502  CI Deploy Role (any branch, non-prod),              \u2502   \u2502  Prod Deploy Role (main only, cross-account assume)  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p>"},{"location":"diagrams/workflow/","title":"Plattr Workflow: Local Dev \u2192 EKS Staging","text":""},{"location":"diagrams/workflow/#end-to-end-developer-workflow","title":"End-to-End Developer Workflow","text":"<p><pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         DEVELOPER WORKSTATION                               \u2502\n\u2502                                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500 1. Initialize \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ plattr init                                                      \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Interactive wizard (name, framework, services)               \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Generates plattr.yaml                                        \u2502   \u2502\n\u2502  \u2502    \u2514\u2500\u2500 Generates .github/workflows/plattr-deploy.yml                \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                              \u2502\n\u2502                              \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500 2. Local Development \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ plattr dev                                                       \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Creates Kind cluster + local registry (:5050)                \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Deploys infra pods (plattr-local namespace):                 \u2502   \u2502\n\u2502  \u2502    \u2502     PostgreSQL :5432                                           \u2502   \u2502\n\u2502  \u2502    \u2502     PostgREST  :3001                                           \u2502   \u2502\n\u2502  \u2502    \u2502     MinIO      :9000/:9001                                     \u2502   \u2502\n\u2502  \u2502    \u2502     Keycloak   :8080                                           \u2502   \u2502\n\u2502  \u2502    \u2502     Redis      :6379                                           \u2502   \u2502\n\u2502  \u2502    \u2502     OpenSearch  :9200/:5601                                    \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Port-forwards all services to localhost                      \u2502   \u2502\n\u2502  \u2502    \u2514\u2500\u2500 Writes .plattr/{appName}.env                                 \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ source .plattr/my-app.env                                        \u2502   \u2502\n\u2502  \u2502  $ npx next dev              \u2190 developer runs their own dev server  \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502\n\u2502  \u2502  \u2502              Kind Cluster (plattr-local ns)                  \u2502   \u2502   \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502   \u2502\n\u2502  \u2502  \u2502  \u2502 PG  \u2502 \u2502 PGRST \u2502 \u2502MinIO\u2502 \u2502Keycloak\u2502 \u2502Redis\u2502 \u2502OpenSrch\u2502 \u2502   \u2502   \u2502\n\u2502  \u2502  \u2502  \u2502:5432\u2502 \u2502 :3001 \u2502 \u2502:9000\u2502 \u2502 :8080  \u2502 \u2502:6379\u2502 \u2502 :9200  \u2502 \u2502   \u2502   \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                              \u2502\n\u2502                              \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500 3. Iterate \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ plattr db migrate --engine prisma    (run migrations)            \u2502   \u2502\n\u2502  \u2502  $ plattr db seed                       (seed data)                 \u2502   \u2502\n\u2502  \u2502  $ plattr test                          (auto-detect runner)        \u2502   \u2502\n\u2502  \u2502  $ plattr db shell                      (psql into local DB)        \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                              \u2502\n\u2502                              \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500 4. Local Deploy (optional validation) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ plattr deploy local                                              \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Run tests (auto-detected)                                    \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Build production image (Dagger)                              \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Push to local registry (localhost:5050)                      \u2502   \u2502\n\u2502  \u2502    \u251c\u2500\u2500 Security scan (Trivy \u2014 HIGH/CRITICAL)                       \u2502   \u2502\n\u2502  \u2502    \u2514\u2500\u2500 Deploy to Kind cluster + port-forward                       \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                              \u2502\n\u2502                              \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500 5. Push Code \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502  $ git push origin feature-branch                                   \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                               \u2502\n                               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           GITHUB                                            \u2502\n\u2502                                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500 6. CI/CD Pipeline (plattr-deploy.yml) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   Trigger: push to branch                                           \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502   \u2502  Step 1: Authenticate                                        \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    AWS OIDC auth \u2192 assume CI Deploy Role (keyless)           \u2502  \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2502                              \u2502                                      \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502   \u2502  Step 2: Test                                                \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    Dagger: ephemeral test with clean state (--ci mode)       \u2502  \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2502                              \u2502                                      \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502   \u2502  Step 3: Build                                               \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    Dagger: build production container image                  \u2502  \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2502                              \u2502                                      \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502   \u2502  Step 4: Push to ECR                                         \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    Push image \u2192 {account}.dkr.ecr.{region}/plattr-apps      \u2502  \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2502                              \u2502                                      \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502\n\u2502  \u2502   \u2502  Step 5: Deploy to Staging                                   \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    kubectl apply Application CR with updated imageRef        \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    \u2192 targets: staging namespace                              \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502                                                              \u2502  \u2502   \u2502\n\u2502  \u2502   \u2502    \u26a0 NOTE: Currently stub/echo placeholders (known gap)     \u2502  \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502\n\u2502  \u2502                              \u2502                                      \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502\n                                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         EKS CLUSTER                                         \u2502\n\u2502                                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500 7. Operator Reconciliation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   Application CR applied to staging namespace                       \u2502   \u2502\n\u2502  \u2502          \u2502                                                          \u2502   \u2502\n\u2502  \u2502          \u25bc                                                          \u2502   \u2502\n\u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502   \u2502\n\u2502  \u2502   \u2502              Plattr Operator (plattr-system)              \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                                                          \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  Informer detects new/updated Application CR             \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  Checks metadata.generation vs last reconciled           \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                                                          \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  Reconciliation pipeline (sequential):                   \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  (on first deploy, all steps create resources;           \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502   on subsequent pushes, most are no-ops via upsert)      \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                                                          \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502 \u2460 reconcileDatabase()                           \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Aurora: CREATE schema staging_my_app          \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   CREATE ROLE staging_my_app_app (CRUD)         \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   CREATE ROLE staging_my_app_anon (PostgREST)   \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   \u2192 Secret: my-app-db (DATABASE_URL)            \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   \u26a0 Does NOT run app migrations (see below)    \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                       \u25bc                                  \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502 \u2461 reconcileStorage()                            \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   S3: CREATE plattr-staging-my-app-uploads      \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Set CORS, public policy if configured         \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   \u2192 ConfigMap: my-app-storage                   \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                       \u25bc                                  \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502 \u2462 reconcileAuth()                               \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Keycloak: CREATE realm, OIDC client           \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Configure identity providers                  \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   \u2192 ConfigMap: my-app-auth                      \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                       \u25bc                                  \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502 \u2463 reconcileWorkload()                           \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   CREATE/UPDATE:                                \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     ServiceAccount: my-app                      \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     Deployment: my-app                          \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502       \u251c\u2500\u2500 app container (from ECR imageRef)     \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502       \u2502   \u2514\u2500\u2500 runs migrations on startup (CMD)  \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502       \u2514\u2500\u2500 PostgREST sidecar (v12.2.3)          \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     Service: my-app (:80, :3001)                \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     Ingress: my-app (all paths)                 \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     Ingress: my-app-api (/api/rest/*)           \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     HPA: my-app (min:2, max:20, cpu:70%)       \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502                       \u25bc                                  \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502 \u2464 reconcileStatus()                             \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Update conditions:                            \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     DatabaseReady: True                         \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     StorageReady: True                          \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     AuthReady: True                             \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     DeploymentReady: True                       \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502     IngressReady: True                          \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2502   Phase: Pending \u2192 Provisioning \u2192 Running       \u2502    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502     \u2502   \u2502\n\u2502  \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                              \u2502                                              \u2502\n\u2502                              \u25bc                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500 8. App is Live \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   external-dns creates Route 53 record:                             \u2502   \u2502\n\u2502  \u2502     my-app.staging.nonprod.yourcompany.dev \u2192 NLB                    \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   cert-manager provisions TLS certificate (Let's Encrypt)           \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   Traffic flow:                                                     \u2502   \u2502\n\u2502  \u2502     Browser \u2192 Route 53 \u2192 NLB \u2192 ingress-nginx \u2192 Service \u2192 Pod       \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2502   Developer can now:                                                \u2502   \u2502\n\u2502  \u2502     $ plattr status --env staging                                   \u2502   \u2502\n\u2502  \u2502     $ plattr logs --env staging -f                                  \u2502   \u2502\n\u2502  \u2502     $ plattr db connect --env staging                               \u2502   \u2502\n\u2502  \u2502     $ plattr env set KEY=VAL --env staging                          \u2502   \u2502\n\u2502  \u2502                                                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n## Database Migration Flow (on subsequent pushes)\n</code></pre>   Developer writes migration locally          \u2502          \u25bc   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  LOCAL                                                          \u2502   \u2502                                                                 \u2502   \u2502  $ npx prisma migrate dev        \u2190 create migration file       \u2502   \u2502  $ plattr db migrate             \u2190 run against local PG        \u2502   \u2502  $ plattr test                   \u2190 verify locally              \u2502   \u2502                                                                 \u2502   \u2502  Migration files are now in your repo (e.g. prisma/migrations/) \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502                                \u25bc   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  GIT PUSH \u2192 CI/CD                                               \u2502   \u2502                                                                 \u2502   \u2502  Image is built with migration files baked in                   \u2502   \u2502  Image pushed to ECR                                            \u2502   \u2502  Application CR updated with new imageRef                       \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                \u2502                                \u25bc   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  EKS \u2014 OPERATOR RECONCILIATION                                  \u2502   \u2502                                                                 \u2502   \u2502  imageRef changed \u2192 reconcileWorkload() triggers rolling update \u2502   \u2502                                                                 \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502  \u2502  What the operator does:                                  \u2502  \u2502   \u2502  \u2502    \u2713 Updates Deployment with new image                    \u2502  \u2502   \u2502  \u2502    \u2713 Rolling update: new pods start, old pods drain       \u2502  \u2502   \u2502  \u2502    \u2713 DB schema/roles already exist (no-op on re-run)     \u2502  \u2502   \u2502  \u2502                                                           \u2502  \u2502   \u2502  \u2502  What the operator does NOT do:                           \u2502  \u2502   \u2502  \u2502    \u2717 Run migration files                                  \u2502  \u2502   \u2502  \u2502    \u2717 Detect schema changes                                \u2502  \u2502   \u2502  \u2502    \u2717 Coordinate migration ordering                        \u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502                                                                 \u2502   \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502  \u2502  New pod starts up:                                       \u2502  \u2502   \u2502  \u2502                                                           \u2502  \u2502   \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502   \u2502  \u2502  \u2502  Container entrypoint (Dockerfile CMD):             \u2502  \u2502  \u2502   \u2502  \u2502  \u2502                                                     \u2502  \u2502  \u2502   \u2502  \u2502  \u2502  1. npx prisma migrate deploy  \u2190 runs new          \u2502  \u2502  \u2502   \u2502  \u2502  \u2502     (idempotent \u2014 skips already-applied migrations) \u2502  \u2502  \u2502   \u2502  \u2502  \u2502                                                     \u2502  \u2502  \u2502   \u2502  \u2502  \u2502  2. node server.js             \u2190 app starts         \u2502  \u2502  \u2502   \u2502  \u2502  \u2502                                                     \u2502  \u2502  \u2502   \u2502  \u2502  \u2502  Connects to Aurora via DATABASE_URL from Secret:   \u2502  \u2502  \u2502   \u2502  \u2502  \u2502    staging_my_app schema                            \u2502  \u2502  \u2502   \u2502  \u2502  \u2502    staging_my_app_app role (full CRUD)              \u2502  \u2502  \u2502   \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502                                                                 \u2502   \u2502  PostgREST sidecar auto-reloads schema via LISTEN/NOTIFY        \u2502   \u2502  New tables/columns immediately available at /api/rest/*        \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p> <p>Alternative: Run migrations manually   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   $ plattr db connect --env staging          \u2190 opens psql to Aurora   $ kubectl get secret my-app-db -n staging  \u2190 get DATABASE_URL   $ DATABASE_URL=&lt;...&gt; npx prisma migrate deploy <pre><code>## Preview Environment Flow (PR-based)\n\n  Developer opens PR #42\n         \u2502\n         \u25bc\n  CI applies PreviewEnvironment CR \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n         \u2502                                                           \u2502\n         \u25bc                                                           \u25bc\n  Operator creates:                                           TTL Controller\n    namespace: preview-my-app-pr-42                           (every 5 min)\n    DB schema: my_app_pr42                                         \u2502\n    S3 bucket: plattr-preview-my-app-pr42-uploads                  \u2502\n    Keycloak realm                                                  \u2502\n    Deployment + PostgREST sidecar (HPA: 1-2)                     \u2502\n    Ingress: pr-42.my-app.preview.nonprod.yourcompany.dev          \u2502\n         \u2502                                                           \u2502\n         \u25bc                                                           \u25bc\n  App live at preview URL \u25c4\u2500\u2500\u2500\u2500 auto-cleanup after 72h \u2500\u2500\u2500\u2500\u2500\u2500 TTL expired\n                                  (cascading namespace delete)\n\n\n## Environment Promotion Path\n\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  push to  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  approve  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  approve  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Local   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Staging  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  UAT  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502 Production \u2502\n  \u2502  (Kind)  \u2502  branch   \u2502  (EKS    \u2502  manual   \u2502 (EKS  \u2502  manual   \u2502 (EKS prod  \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502 nonprod) \u2502           \u2502nonprod\u2502           \u2502  account)  \u2502\n       \u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                       \u2502                      \u2502                    \u2502\n  plattr dev            CI Deploy Role          CI Deploy Role      Prod Deploy Role\n  HTTP, localhost       HTTPS, *.staging.       HTTPS, *.uat.       HTTPS, *.prod.\n  Container PG/Redis    Container PG/Redis      Container PG/Redis  Aurora, ElastiCache\n  MinIO, OpenSearch     Container OpenSearch    Container OpenSearch OpenSearch Service\n  No scaling            HPA 2-20               HPA 2-20            HPA 2-20\n\n\n## What Changes Between Environments\n\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502   Component      \u2502  Local (Kind)    \u2502 Staging/UAT (EKS)\u2502 Production (EKS)     \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502 Database         \u2502 PG pod (:5432)   \u2502 Shared Aurora    \u2502 Dedicated Aurora     \u2502\n  \u2502 DB Schema        \u2502 {app_name}       \u2502 staging_{app}    \u2502 prod_{app}           \u2502\n  \u2502 Object Storage   \u2502 MinIO (:9000)    \u2502 S3 (IRSA)        \u2502 S3 (IRSA)            \u2502\n  \u2502 Auth             \u2502 Keycloak (:8080) \u2502 Keycloak (HTTPS) \u2502 Keycloak (HTTPS)     \u2502\n  \u2502 Redis            \u2502 Pod (:6379)      \u2502 Pod (:6379)      \u2502 ElastiCache Redis 7  \u2502\n  \u2502 OpenSearch       \u2502 Pod (:9200)      \u2502 Pod (:9200)      \u2502 OpenSearch Service   \u2502\n  \u2502 TLS              \u2502 HTTP (no TLS)    \u2502 HTTPS (LE)       \u2502 HTTPS (LE)           \u2502\n  \u2502 DNS              \u2502 localhost         \u2502 *.staging/uat    \u2502 *.prod.{baseDomain}  \u2502\n  \u2502 Registry         \u2502 localhost:5050   \u2502 ECR (nonprod)    \u2502 ECR (cross-account)  \u2502\n  \u2502 Scaling          \u2502 Single replica   \u2502 HPA (2-20)       \u2502 HPA (2-20)           \u2502\n  \u2502 DB Credentials   \u2502 localdev         \u2502 Random 32B hex   \u2502 Random 32B hex       \u2502\n  \u2502 Dev Server       \u2502 Native (npx)    \u2502 Containerized    \u2502 Containerized        \u2502\n  \u2502 AWS Account      \u2502 N/A              \u2502 Non-prod         \u2502 Prod (separate)      \u2502\n  \u2502 Operator Mode    \u2502 Local            \u2502 Container mode   \u2502 Managed mode         \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n## Production Deployment Flow (cross-account)\n\n  GitHub Actions (main branch merge)\n         \u2502\n         \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Production Job                                                 \u2502\n  \u2502                                                                 \u2502\n  \u2502  1. Assume AWS_ROLE_ARN_PROD (prod deploy role)                \u2502\n  \u2502     \u2514\u2500\u2500 Non-prod role \u2192 sts:AssumeRole \u2192 prod account role     \u2502\n  \u2502                                                                 \u2502\n  \u2502  2. aws eks update-kubeconfig --name plattr-prod                \u2502\n  \u2502     \u2514\u2500\u2500 Targets the prod account's EKS cluster                 \u2502\n  \u2502                                                                 \u2502\n  \u2502  3. kubectl apply Application CR                                \u2502\n  \u2502     \u2514\u2500\u2500 namespace: production                                   \u2502\n  \u2502     \u2514\u2500\u2500 imageRef: ECR image from non-prod (cross-account pull) \u2502\n  \u2502                                                                 \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Prod EKS Cluster \u2014 Operator Reconciliation                     \u2502\n  \u2502                                                                 \u2502\n  \u2502  Operator runs in MANAGED MODE (env vars set by CDK):          \u2502\n  \u2502    REDIS_ENDPOINT \u2192 ElastiCache serverless endpoint            \u2502\n  \u2502    OPENSEARCH_ENDPOINT \u2192 OpenSearch Service domain endpoint    \u2502\n  \u2502                                                                 \u2502\n  \u2502  Reconciliation:                                                \u2502\n  \u2502    \u2460 reconcileDatabase \u2014 Aurora (dedicated prod instance)       \u2502\n  \u2502    \u2461 reconcileStorage  \u2014 S3 buckets                            \u2502\n  \u2502    \u2462 reconcileAuth     \u2014 Keycloak (on prod EKS)                \u2502\n  \u2502    \u2463 reconcileRedis    \u2014 ConfigMap \u2192 ElastiCache endpoint      \u2502\n  \u2502    \u2464 reconcileOpenSearch \u2014 ConfigMap \u2192 OpenSearch endpoint     \u2502\n  \u2502    \u2465 reconcileWorkload \u2014 Deployment + PostgREST + envFrom      \u2502\n  \u2502    \u2466 reconcileStatus   \u2014 Conditions + phase                    \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"reference/architecture/","title":"Architecture Deep-Dive","text":"<p>This document covers the internal architecture of Plattr: how reconciliation works, how resources flow through the system, and how local and remote environments achieve parity.</p>"},{"location":"reference/architecture/#system-components","title":"System Components","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   CLI        \u2502     \u2502   Dagger     \u2502     \u2502   CDK        \u2502\n\u2502  (developer  \u2502     \u2502  (build &amp;    \u2502     \u2502  (infra      \u2502\n\u2502   commands)  \u2502     \u2502   CI tests)  \u2502     \u2502   stacks)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502                    \u2502                    \u2502\n       \u2502  kubectl/kind      \u2502  build images      \u2502  CloudFormation\n       v                    v                    v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Kubernetes  \u2502     \u2502  Docker      \u2502     \u2502  AWS         \u2502\n\u2502  (Kind local \u2502     \u2502  (registry   \u2502     \u2502  (EKS, RDS,  \u2502\n\u2502   or EKS)    \u2502     \u2502   :5050)     \u2502     \u2502   S3, etc.)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u2502\n       \u2502  watch events\n       v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                 Plattr Operator                    \u2502\n\u2502                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Database   \u2502 \u2502  Storage   \u2502 \u2502   Auth     \u2502    \u2502\n\u2502  \u2502 Reconciler  \u2502 \u2502 Reconciler \u2502 \u2502 Reconciler \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Workload   \u2502 \u2502  Preview   \u2502 \u2502   Status   \u2502    \u2502\n\u2502  \u2502 Reconciler  \u2502 \u2502 Reconciler \u2502 \u2502 Reconciler \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502\n\u2502  \u2502    TTL      \u2502 \u2502   Leader   \u2502                    \u2502\n\u2502  \u2502 Controller  \u2502 \u2502  Election  \u2502                    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/architecture/#reconciliation-loop","title":"Reconciliation Loop","text":"<p>The operator uses Kubernetes informers to watch for changes to <code>Application</code> and <code>PreviewEnvironment</code> CRDs.</p>"},{"location":"reference/architecture/#event-flow","title":"Event Flow","text":"<pre><code>1. User applies Application CR\n2. K8s API Server stores the resource\n3. Informer fires 'add' or 'update' event\n4. Operator checks metadata.generation vs last reconciled generation\n5. If generation changed \u2192 run reconciliation\n6. Reconciliation runs sequentially:\n   a. reconcileDatabase()    \u2192 creates schema, roles, Secret\n   b. reconcileStorage()     \u2192 creates S3 buckets, ConfigMap\n   c. reconcileAuth()        \u2192 creates Keycloak realm, ConfigMap\n   d. reconcileWorkload()    \u2192 creates Deployment, Service, Ingress, HPA\n   e. reconcileStatus()      \u2192 updates status conditions and phase\n7. Store reconciled generation to prevent re-processing\n</code></pre>"},{"location":"reference/architecture/#generation-based-tracking","title":"Generation-Based Tracking","text":"<p>The operator tracks <code>metadata.generation</code> for each Application to avoid infinite reconciliation loops:</p> <pre><code>reconciledGenerations: Map&lt;string, number&gt;\n</code></pre> <ul> <li><code>metadata.generation</code> only increments when the spec changes (not status)</li> <li>Status updates via the status subresource do not trigger re-reconciliation</li> <li>If the generation matches what was last reconciled, the event is skipped</li> <li>On <code>delete</code> events, the generation is removed from the map after cleanup</li> </ul>"},{"location":"reference/architecture/#retry-logic","title":"Retry Logic","text":"<p>Each reconciler uses exponential backoff with jitter:</p> Attempt Base Delay With Jitter (50-150%) 1 1s 0.5s - 1.5s 2 2s 1s - 3s 3 4s 2s - 6s <p>Maximum 3 retries per reconciliation. Maximum delay capped at 30 seconds.</p>"},{"location":"reference/architecture/#upsert-pattern","title":"Upsert Pattern","text":"<p>All Kubernetes resource creation uses an idempotent upsert pattern:</p> <pre><code>1. Try create (POST)\n2. If 409 Conflict \u2192 resource already exists \u2192 replace (PUT)\n3. If other error \u2192 throw\n</code></pre> <p>This makes reconciliation safe to retry and handles cases where resources were partially created in a previous attempt.</p>"},{"location":"reference/architecture/#resource-lifecycle","title":"Resource Lifecycle","text":""},{"location":"reference/architecture/#application-lifecycle","title":"Application Lifecycle","text":"<pre><code>                    apply\n  (nothing) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Pending\n                                \u2502\n                                \u2502 reconcileDatabase()\n                                \u2502 reconcileStorage()\n                                \u2502 reconcileAuth()\n                                v\n                            Provisioning\n                                \u2502\n                                \u2502 reconcileWorkload()\n                                \u2502 pods become ready\n                                v\n                             Running \u25c4\u2500\u2500\u2500\u2500 spec change triggers re-reconcile\n                                \u2502\n                                \u2502 kubectl delete\n                                v\n                            Terminating\n                                \u2502\n                                \u2502 cleanupWorkload()\n                                \u2502 cleanupAuth()\n                                \u2502 cleanupStorage()\n                                \u2502 cleanupDatabase()\n                                v\n                            (deleted)\n</code></pre>"},{"location":"reference/architecture/#resources-created-per-application","title":"Resources Created per Application","text":"Reconciler Resources External Services Database Secret (<code>{name}-db</code>) PostgreSQL schema, app role, anon role Storage ConfigMap (<code>{name}-storage</code>) S3 buckets (with CORS and public policy if configured) Auth ConfigMap (<code>{name}-auth</code>) Keycloak realm, OIDC client Workload ServiceAccount, Deployment, Service, Ingress, Ingress (API), HPA \u2014"},{"location":"reference/architecture/#cleanup-order","title":"Cleanup Order","text":"<p>Cleanup runs in reverse order to avoid dangling references:</p> <ol> <li>Workload (Deployment, Service, Ingress, HPA)</li> <li>Auth (Keycloak realm, ConfigMap)</li> <li>Storage (S3 buckets, ConfigMap)</li> <li>Database (PostgreSQL roles, schema, Secret)</li> </ol> <p>Database cleanup is especially careful with role dependencies: <pre><code>REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA {schema} FROM {role};\nALTER DEFAULT PRIVILEGES IN SCHEMA {schema} REVOKE ALL ON TABLES FROM {role};\nREASSIGN OWNED BY {role} TO postgres;\nDROP OWNED BY {role};\nDROP ROLE IF EXISTS {role};\n</code></pre></p>"},{"location":"reference/architecture/#environment-prefixing","title":"Environment Prefixing","text":"<p>All database schemas, roles, and S3 buckets are prefixed by environment to enable isolation within shared infrastructure.</p>"},{"location":"reference/architecture/#database-prefixing","title":"Database Prefixing","text":"Environment Schema App Role Anon Role production <code>prod_my_app</code> <code>prod_my_app_app</code> <code>prod_my_app_anon</code> staging <code>staging_my_app</code> <code>staging_my_app_app</code> <code>staging_my_app_anon</code> uat <code>uat_my_app</code> <code>uat_my_app_app</code> <code>uat_my_app_anon</code> preview (PR 42) <code>my_app_pr42</code> <code>my-app-pr42_app</code> <code>my-app-pr42_anon</code> <p>Preview environments don't add an extra prefix because the name already includes the PR number.</p> <p>Hyphens are replaced with underscores in schema and role names because PostgreSQL identifiers cannot contain hyphens.</p>"},{"location":"reference/architecture/#storage-prefixing","title":"Storage Prefixing","text":"<p>S3 bucket names: <code>plattr-{env}-{app}-{bucket}</code></p> <p>Examples: - <code>plattr-prod-my-app-uploads</code> - <code>plattr-staging-my-app-uploads</code> - <code>plattr-preview-my-app-pr42-uploads</code></p>"},{"location":"reference/architecture/#postgrest-sidecar-pattern","title":"PostgREST Sidecar Pattern","text":"<p>When <code>database.enabled: true</code>, the operator adds PostgREST as a sidecar container in the app Deployment.</p>"},{"location":"reference/architecture/#pod-layout","title":"Pod Layout","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Pod                 \u2502\n\u2502                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502    App     \u2502  \u2502 PostgREST \u2502  \u2502\n\u2502  \u2502  :3000     \u2502  \u2502  :3001    \u2502  \u2502\n\u2502  \u2502            \u2502  \u2502           \u2502  \u2502\n\u2502  \u2502 envFrom:   \u2502  \u2502 PGRST_*   \u2502  \u2502\n\u2502  \u2502  db secret \u2502  \u2502 env vars  \u2502  \u2502\n\u2502  \u2502  storage cm\u2502  \u2502           \u2502  \u2502\n\u2502  \u2502  auth cm   \u2502  \u2502 DB_URI \u2190  \u2502  \u2502\n\u2502  \u2502            \u2502  \u2502  from     \u2502  \u2502\n\u2502  \u2502 POSTGREST_ \u2502  \u2502  secret   \u2502  \u2502\n\u2502  \u2502 INTERNAL_  \u2502  \u2502           \u2502  \u2502\n\u2502  \u2502 URL=       \u2502  \u2502 SCHEMAS=  \u2502  \u2502\n\u2502  \u2502 localhost  \u2502  \u2502 prod_app  \u2502  \u2502\n\u2502  \u2502 :3001      \u2502  \u2502           \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"reference/architecture/#why-a-sidecar","title":"Why a Sidecar?","text":"<ul> <li>Shared lifecycle \u2014 scales with the app, restarts with the app</li> <li>Localhost access \u2014 app can call PostgREST at <code>localhost:3001</code> with no network hop</li> <li>No extra Service \u2014 no separate Deployment or scaling concern</li> <li>Resource efficient \u2014 PostgREST is a lightweight Haskell binary (50m CPU, 64Mi memory)</li> </ul>"},{"location":"reference/architecture/#postgrest-configuration","title":"PostgREST Configuration","text":"Env Var Value Purpose <code>PGRST_DB_URI</code> From Secret <code>{name}-db</code>, key <code>DATABASE_URL</code> Database connection <code>PGRST_DB_SCHEMAS</code> <code>{env}_{app_name}</code> Which schema to expose <code>PGRST_DB_ANON_ROLE</code> <code>{env}_{app_name}_anon</code> Anonymous access role <code>PGRST_SERVER_PORT</code> <code>3001</code> Listening port <code>PGRST_DB_CHANNEL_ENABLED</code> <code>true</code> Auto-reload on schema changes <p>Image version: <code>postgrest/postgrest:v12.2.3</code> (pinned, not <code>:latest</code>)</p>"},{"location":"reference/architecture/#ingress-routing","title":"Ingress Routing","text":"<p>Each app with a database gets two Ingress resources:</p>"},{"location":"reference/architecture/#main-ingress-name","title":"Main Ingress (<code>{name}</code>)","text":"<pre><code>spec:\n  rules:\n    - host: my-app.platform.company.dev\n      http:\n        paths:\n          - path: /\n            pathType: Prefix\n            backend:\n              service:\n                name: my-app\n                port:\n                  number: 80    # \u2192 app container :3000\n</code></pre>"},{"location":"reference/architecture/#api-ingress-name-api","title":"API Ingress (<code>{name}-api</code>)","text":"<pre><code>metadata:\n  annotations:\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\nspec:\n  rules:\n    - host: my-app.platform.company.dev\n      http:\n        paths:\n          - path: /api/rest(/|$)(.*)\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: my-app\n                port:\n                  number: 3001  # \u2192 PostgREST container :3001\n</code></pre> <p>The rewrite annotation strips <code>/api/rest</code> from the path: - <code>GET /api/rest/todos</code> \u2192 PostgREST receives <code>GET /todos</code> - <code>GET /api/rest/todos?id=eq.1</code> \u2192 PostgREST receives <code>GET /todos?id=eq.1</code></p> <p>Both Ingresses share the same TLS certificate and domain.</p>"},{"location":"reference/architecture/#local-vs-remote-parity","title":"Local vs Remote Parity","text":"<p>Plattr ensures that code written for local development works in production without changes.</p>"},{"location":"reference/architecture/#environment-variable-parity","title":"Environment Variable Parity","text":"Variable Local (Kind) Remote (Operator) <code>DATABASE_URL</code> <code>postgresql://plattr:localdev@127.0.0.1:5432/plattr?search_path={schema}</code> <code>postgresql://{app}_app:{random}@aurora:5432/plattr?search_path={env}_{schema}</code> <code>POSTGREST_URL</code> <code>http://127.0.0.1:3001</code> <code>https://{domain}/api/rest</code> <code>POSTGREST_INTERNAL_URL</code> (not set) <code>http://localhost:3001</code> <code>S3_ENDPOINT</code> <code>http://127.0.0.1:9000</code> (AWS S3 default) <code>S3_BUCKET_*</code> <code>{app}-{bucket}</code> <code>plattr-{env}-{app}-{bucket}</code> <code>AUTH_ISSUER_URL</code> <code>http://127.0.0.1:8080/realms/{app}</code> <code>https://auth.{baseDomain}/realms/{app}</code> <code>AUTH_CLIENT_ID</code> <code>{app}-app</code> <code>{app}</code> <code>REDIS_URL</code> <code>redis://127.0.0.1:6379</code> <code>redis://{managed-redis}:6379</code> <code>OPENSEARCH_URL</code> <code>http://127.0.0.1:9200</code> <code>https://{managed-opensearch}:443</code>"},{"location":"reference/architecture/#service-parity","title":"Service Parity","text":"Service Local Remote PostgreSQL Pod in Kind cluster (port-forwarded to :5432) Aurora PostgreSQL Object Storage MinIO pod (port-forwarded to :9000) AWS S3 Authentication Keycloak pod (port-forwarded to :8080) Keycloak on EKS (HA) REST API PostgREST pod (port-forwarded to :3001) PostgREST sidecar Redis Redis pod (port-forwarded to :6379) Managed Redis OpenSearch OpenSearch pod (port-forwarded to :9200) Managed OpenSearch App Server Native dev server (run manually) Production build in container Container Registry Local registry on :5050 ECR"},{"location":"reference/architecture/#what-differs","title":"What Differs","text":"<ul> <li>TLS: Local uses HTTP, remote uses HTTPS (cert-manager + Let's Encrypt)</li> <li>DNS: Local uses <code>localhost</code> via port-forwards, remote uses real domains (external-dns + Route 53)</li> <li>Scaling: Local is single-instance, remote uses HPA</li> <li>Storage credentials: Local uses MinIO defaults, remote uses IRSA</li> <li>Database passwords: Local uses <code>localdev</code>, remote uses random 32-byte hex</li> <li>Dev server: Local runs natively (you start it), remote runs as a container</li> <li>Registry: Local uses <code>localhost:5050</code>, remote uses ECR</li> </ul>"},{"location":"reference/architecture/#preview-environment-architecture","title":"Preview Environment Architecture","text":"<pre><code>PreviewEnvironment CR\n        \u2502\n        v\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  preview-my-app-pr-42 (namespace)          \u2502\n\u2502                                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502  Deployment   \u2502  \u2502   Service    \u2502       \u2502\n\u2502  \u2502 my-app-pr42   \u2502  \u2502 my-app-pr42  \u2502       \u2502\n\u2502  \u2502 (app +        \u2502  \u2502 :80, :3001   \u2502       \u2502\n\u2502  \u2502  postgrest)   \u2502  \u2502              \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502  \u2502   Ingress     \u2502  \u2502   Secret     \u2502       \u2502\n\u2502  \u2502 pr-42.app.    \u2502  \u2502 my-app-      \u2502       \u2502\n\u2502  \u2502  preview.     \u2502  \u2502  pr42-db     \u2502       \u2502\n\u2502  \u2502  domain.dev   \u2502  \u2502              \u2502       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key properties: - Isolated namespace per preview \u2014 no cross-contamination - Own database schema \u2014 <code>my_app_pr42</code> (separate from production) - Own S3 buckets \u2014 <code>plattr-preview-my-app-pr42-uploads</code> - Reduced scaling \u2014 min 1, max 2 replicas - TTL-based cleanup \u2014 controller sweeps every 5 minutes, deletes expired previews - Cascading deletion \u2014 namespace deletion removes all child resources</p>"},{"location":"reference/architecture/#ttl-controller","title":"TTL Controller","text":"<pre><code>Every 5 minutes:\n  1. List all PreviewEnvironment CRs\n  2. For each: check status.expiresAt\n  3. If expired:\n     a. cleanupPreview() \u2014 delete database schema, S3 buckets, namespace\n     b. Delete PreviewEnvironment CR\n</code></pre> <p>TTL format: <code>72h</code> (default), <code>5m</code>, <code>2h</code>, <code>3d</code></p>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>The <code>plattr</code> CLI is the developer interface to the platform. Install it with <code>npm install -g @plattr/cli</code>.</p>"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#plattr-init","title":"<code>plattr init</code>","text":"<p>Initialize a new app for the platform.</p> <pre><code>plattr init\n</code></pre> <p>Interactive prompts: 1. App name (lowercase alphanumeric with hyphens) 2. Framework (auto-detected: <code>nextjs</code>, <code>rails</code>, <code>static</code>, <code>docker</code>) 3. Enable database? 4. Enable storage? 5. Enable authentication? 6. Enable Redis cache? 7. Enable OpenSearch?</p> <p>Creates: - <code>plattr.yaml</code> \u2014 app configuration - <code>.github/workflows/plattr-deploy.yml</code> \u2014 CI/CD pipeline</p>"},{"location":"reference/cli/#plattr-dev","title":"<code>plattr dev</code>","text":"<p>Set up local infrastructure and prepare the environment for development.</p> <pre><code>plattr dev [options]\n</code></pre> Option Description Default <code>-p, --port &lt;port&gt;</code> Port hint (reserved for future use) <code>3000</code> (or <code>local.port</code> from config) <p>What it does:</p> <ol> <li>Creates a local Kind cluster (if not already running)</li> <li>Starts a local container registry on port 5050</li> <li>Applies Kubernetes manifests for enabled services (PostgreSQL, PostgREST, MinIO, Keycloak, Redis, OpenSearch)</li> <li>Waits for all services to be ready</li> <li>Sets up database schema and roles</li> <li>Creates storage buckets</li> <li>Starts detached <code>kubectl port-forward</code> processes</li> <li>Writes environment variables to <code>.plattr/{appName}.env</code></li> <li>Prints export commands and service URLs</li> </ol> <p>Important: <code>plattr dev</code> does not start your application's dev server. After it completes, source the env file and start your dev server manually:</p> <pre><code>plattr dev\nsource .plattr/my-app.env\nnpx next dev          # Next.js\nbin/rails server      # Rails\n</code></pre> <p>Services started (conditional on <code>plattr.yaml</code>):</p> Service Port Condition PostgreSQL 5432 Always PostgREST 3001 <code>database.enabled: true</code> MinIO 9000, 9001 <code>storage.enabled: true</code> Keycloak 8080 <code>auth.enabled: true</code> Redis 6379 <code>redis.enabled: true</code> OpenSearch 9200 <code>search.enabled: true</code> OpenSearch Dashboards 5601 <code>search.enabled: true</code> <p>State files (in <code>.plattr/</code> directory): - <code>{appName}.env</code> \u2014 environment variables (sourceable) - <code>{appName}.pids</code> \u2014 port-forward process IDs</p>"},{"location":"reference/cli/#plattr-test","title":"<code>plattr test</code>","text":"<p>Run tests against local infrastructure.</p> <pre><code>plattr test [options]\n</code></pre> Option Description Default <code>--ci</code> Run Dagger-based ephemeral tests (clean state) <code>false</code> <p>Without <code>--ci</code> (default): Auto-detects the test runner and runs tests locally using the environment from <code>.plattr/{appName}.env</code>. Checks that infrastructure is running before starting.</p> <p>Supported test runners (auto-detected): - Vitest \u2014 detects <code>vitest.config.{ts,js,mts}</code> - Jest \u2014 detects <code>jest.config.{ts,js,mjs}</code> - npm test \u2014 uses <code>package.json</code> test script (if it exists and isn't the default) - RSpec \u2014 detects <code>spec/**/*.rb</code> (Rails) - Minitest \u2014 detects <code>test/**/*.rb</code> (Rails)</p> <p>With <code>--ci</code>: Runs <code>dagger call test --source=.</code> for fully ephemeral tests with clean database state.</p> <p>Example: <pre><code># Run local tests (requires plattr dev running)\nplattr test\n\n# Run ephemeral tests via Dagger\nplattr test --ci\n</code></pre></p>"},{"location":"reference/cli/#plattr-build","title":"<code>plattr build</code>","text":"<p>Build a production container image.</p> <pre><code>plattr build\n</code></pre> <p>Runs <code>dagger call build --source=.</code> to produce an optimized production image based on the detected framework.</p>"},{"location":"reference/cli/#plattr-deploy-local","title":"<code>plattr deploy local</code>","text":"<p>Build, test, scan, and deploy the app to the local Kind cluster.</p> <pre><code>plattr deploy local [options]\n</code></pre> Option Description Default <code>-p, --port &lt;port&gt;</code> Port for the deployed app <code>3000</code> (or <code>local.port</code> from config) <code>--skip-tests</code> Skip the test step <code>false</code> <code>--skip-scan</code> Skip the Trivy security scan <code>false</code> <code>--fail-on-scan</code> Exit with error if vulnerabilities found (no prompt) <code>false</code> <p>Pipeline steps:</p> <ol> <li>Tests \u2014 Auto-detects and runs tests (skippable with <code>--skip-tests</code>)</li> <li>Build \u2014 Builds production image via Dagger</li> <li>Push \u2014 Pushes image to local registry (<code>localhost:5050</code>)</li> <li>Security Scan \u2014 Runs Trivy scan for HIGH/CRITICAL vulnerabilities (skippable with <code>--skip-scan</code>)</li> <li>Deploy \u2014 Applies Kubernetes manifests (ConfigMap, Deployment, Service) and waits for rollout</li> <li>Port-forward \u2014 Starts a detached port-forward to the deployed app</li> </ol> <p>Example: <pre><code># Full pipeline\nplattr deploy local\n\n# Quick deploy (skip tests and scan)\nplattr deploy local --skip-tests --skip-scan\n\n# CI-style (fail on vulnerabilities)\nplattr deploy local --fail-on-scan\n</code></pre></p>"},{"location":"reference/cli/#plattr-undeploy-local","title":"<code>plattr undeploy local</code>","text":"<p>Remove the app deployment from the local Kind cluster.</p> <pre><code>plattr undeploy local\n</code></pre> <p>Kills tracked port-forward processes and deletes the Deployment, Service, and ConfigMap from the cluster. Does not remove the infrastructure (PostgreSQL, MinIO, etc.) \u2014 use <code>plattr infra destroy</code> for that.</p>"},{"location":"reference/cli/#plattr-infra-init","title":"<code>plattr infra init</code>","text":"<p>Interactively generate AWS infrastructure configuration.</p> <pre><code>plattr infra init\n</code></pre> <p>Walks through a guided setup to collect AWS account, region, EKS cluster settings, domain configuration, and add-on preferences. Writes a <code>packages/cdk/cdk.json</code> with all CDK context values populated, replacing the need to pass individual <code>-c</code> flags to <code>cdk deploy</code>.</p> <p>Supports two environment types:</p> <ul> <li>Non-prod \u2014 choose between CDK-managed infrastructure (new VPC + EKS + Aurora) or connecting to existing infrastructure (provide ARNs and endpoints).</li> <li>Production \u2014 configures EKS, Aurora, OpenSearch, and optional cross-account settings.</li> </ul> <p>After running, follow the printed next steps to bootstrap and deploy:</p> <pre><code>cd packages/cdk\nnpm install\nnpx cdk bootstrap\nnpx cdk deploy --all\n</code></pre>"},{"location":"reference/cli/#plattr-infra-status","title":"<code>plattr infra status</code>","text":"<p>Show local infrastructure status.</p> <pre><code>plattr infra status\n</code></pre> <p>Displays all pods in the <code>plattr-local</code> namespace.</p>"},{"location":"reference/cli/#plattr-infra-stop","title":"<code>plattr infra stop</code>","text":"<p>Stop local infrastructure (data preserved).</p> <pre><code>plattr infra stop\n</code></pre> <p>Kills port-forward processes and scales all deployments to zero replicas. Data in persistent volumes is preserved. Run <code>plattr dev</code> to restart.</p>"},{"location":"reference/cli/#plattr-infra-start","title":"<code>plattr infra start</code>","text":"<p>Start local infrastructure.</p> <pre><code>plattr infra start\n</code></pre> <p>Scales all deployments back to one replica. Use this after <code>plattr infra stop</code> to resume without a full <code>plattr dev</code> cycle.</p>"},{"location":"reference/cli/#plattr-infra-destroy","title":"<code>plattr infra destroy</code>","text":"<p>Delete local cluster and all data.</p> <pre><code>plattr infra destroy\n</code></pre> <p>Kills port-forward processes, clears all state files (<code>.plattr/</code>), deletes the Kind cluster, and removes the local container registry. All data is lost. Run <code>plattr dev</code> to recreate from scratch.</p>"},{"location":"reference/cli/#plattr-preview-start","title":"<code>plattr preview start</code>","text":"<p>Start a local preview environment for a pull request.</p> <pre><code>plattr preview start --pr &lt;number&gt; [options]\n</code></pre> Option Description Default <code>--pr &lt;number&gt;</code> Pull request number (required) \u2014 <code>-p, --port &lt;port&gt;</code> Port for the preview app <code>3100</code> <p>Creates an isolated environment with PR-specific database schema and storage.</p> <p>Example: <pre><code>plattr preview start --pr 42\nplattr preview start --pr 42 --port 3200\n</code></pre></p>"},{"location":"reference/cli/#plattr-preview-list","title":"<code>plattr preview list</code>","text":"<p>List active remote preview environments.</p> <pre><code>plattr preview list\n</code></pre> <p>Output: <pre><code>PR   App          Phase     URL                                          Expires\n42   my-app       Running   https://pr-42.my-app.preview.company.dev     2024-01-15T12:00:00Z\n</code></pre></p> <p>Queries <code>PreviewEnvironment</code> CRDs via kubectl.</p>"},{"location":"reference/cli/#plattr-db-migrate","title":"<code>plattr db migrate</code>","text":"<p>Run database migrations.</p> <pre><code>plattr db migrate [options]\n</code></pre> Option Description Default <code>--engine &lt;engine&gt;</code> Migration engine: <code>prisma</code>, <code>knex</code>, <code>raw</code> Auto-detect <p>Engines: - <code>prisma</code> \u2014 runs <code>npx prisma migrate deploy</code> - <code>knex</code> \u2014 runs <code>npx knex migrate:latest</code> - <code>raw</code> \u2014 executes <code>.sql</code> files from the migrations directory</p> <p>Example: <pre><code>plattr db migrate\nplattr db migrate --engine prisma\n</code></pre></p>"},{"location":"reference/cli/#plattr-db-seed","title":"<code>plattr db seed</code>","text":"<p>Seed the database with test data.</p> <pre><code>plattr db seed [options]\n</code></pre> Option Description Default <code>--file &lt;path&gt;</code> Path to seed file <code>seed.sql</code> <p>Example: <pre><code>plattr db seed\nplattr db seed --file seeds/test-data.sql\n</code></pre></p>"},{"location":"reference/cli/#plattr-db-shell","title":"<code>plattr db shell</code>","text":"<p>Open an interactive <code>psql</code> shell connected to the local database.</p> <pre><code>plattr db shell\n</code></pre>"},{"location":"reference/cli/#plattr-db-connect","title":"<code>plattr db connect</code>","text":"<p>Connect to a remote database via <code>psql</code>.</p> <pre><code>plattr db connect [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <p>Retrieves the <code>DATABASE_URL</code> from the Kubernetes Secret (<code>{appName}-db</code>) and opens an interactive <code>psql</code> session.</p> <p>Example: <pre><code>plattr db connect\nplattr db connect --env staging\n</code></pre></p>"},{"location":"reference/cli/#plattr-db-reset","title":"<code>plattr db reset</code>","text":"<p>Reset the local database (deletes all data).</p> <pre><code>plattr db reset\n</code></pre> <p>Deletes the persistent volume claim and restarts the PostgreSQL deployment. Run <code>plattr dev</code> to recreate schemas.</p>"},{"location":"reference/cli/#plattr-redis-reset","title":"<code>plattr redis reset</code>","text":"<p>Reset local Redis (deletes all data).</p> <pre><code>plattr redis reset\n</code></pre> <p>Deletes the persistent volume claim and restarts the Redis deployment.</p>"},{"location":"reference/cli/#plattr-search-reset","title":"<code>plattr search reset</code>","text":"<p>Reset local OpenSearch (deletes all data).</p> <pre><code>plattr search reset\n</code></pre> <p>Deletes the persistent volume claim and restarts the OpenSearch deployment.</p>"},{"location":"reference/cli/#plattr-status","title":"<code>plattr status</code>","text":"<p>Show application status and conditions.</p> <pre><code>plattr status [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <code>--pr &lt;number&gt;</code> PR number (for preview envs) \u2014 <p>Output: <pre><code>Application: my-app\nEnvironment: production\nPhase:       Running\nURL:         https://my-app.platform.company.dev\n\nConditions:\n  DatabaseReady\n  StorageReady\n  AuthReady\n  DeploymentReady\n  IngressReady\n</code></pre></p> <p>Example: <pre><code>plattr status\nplattr status --env staging\nplattr status --pr 42\n</code></pre></p>"},{"location":"reference/cli/#plattr-logs","title":"<code>plattr logs</code>","text":"<p>Stream application logs.</p> <pre><code>plattr logs [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <code>-f, --follow</code> Stream logs continuously <code>false</code> <code>--tail &lt;lines&gt;</code> Number of recent lines to show All <code>--pr &lt;number&gt;</code> PR number (for preview envs) \u2014 <p>Runs <code>kubectl logs</code> with <code>--all-containers</code> to include both app and PostgREST sidecar logs.</p> <p>Example: <pre><code>plattr logs\nplattr logs -f\nplattr logs --tail 100 --env staging\nplattr logs --pr 42 -f\n</code></pre></p>"},{"location":"reference/cli/#plattr-env-set","title":"<code>plattr env set</code>","text":"<p>Set one or more environment variables.</p> <pre><code>plattr env set &lt;KEY=VALUE...&gt; [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <p>Creates or updates a ConfigMap (<code>{appName}-env</code>) and restarts the Deployment to apply changes.</p> <p>Example: <pre><code>plattr env set API_KEY=abc123\nplattr env set API_KEY=abc123 FEATURE_FLAG=true\nplattr env set --env staging DEBUG=true\n</code></pre></p>"},{"location":"reference/cli/#plattr-env-list","title":"<code>plattr env list</code>","text":"<p>List all environment variables (Plattr-managed and user-defined).</p> <pre><code>plattr env list [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <p>Example: <pre><code>plattr env list\nplattr env list --env staging\n</code></pre></p>"},{"location":"reference/cli/#plattr-env-unset","title":"<code>plattr env unset</code>","text":"<p>Remove an environment variable.</p> <pre><code>plattr env unset &lt;KEY&gt; [options]\n</code></pre> Option Description Default <code>--env &lt;environment&gt;</code> Target environment <code>production</code> <p>Removes the key from the ConfigMap and restarts the Deployment.</p> <p>Example: <pre><code>plattr env unset API_KEY\nplattr env unset --env staging DEBUG\n</code></pre></p>"},{"location":"reference/cli/#environment-resolution","title":"Environment Resolution","text":"<p>Commands that accept <code>--env</code> map environment names to Kubernetes namespaces:</p> <code>--env</code> value Namespace Resource Name <code>production</code> <code>production</code> <code>{appName}</code> <code>staging</code> <code>staging</code> <code>{appName}</code> <code>uat</code> <code>uat</code> <code>{appName}</code> <code>preview</code> (with <code>--pr</code>) <code>preview-{appName}-pr-{N}</code> <code>{appName}-pr{N}</code> <p>The app name is read from <code>plattr.yaml</code> in the current directory.</p>"},{"location":"reference/crds/","title":"CRD Reference","text":"<p>Plattr defines two Custom Resource Definitions in the <code>platform.internal</code> API group.</p>"},{"location":"reference/crds/#application","title":"Application","text":"<p>API Version: <code>platform.internal/v1alpha1</code> Kind: <code>Application</code> Plural: <code>applications</code> Short Names: <code>app</code>, <code>apps</code> Scope: Namespaced</p>"},{"location":"reference/crds/#spec-fields","title":"Spec Fields","text":"Field Type Required Default Description <code>repository</code> string Yes \u2014 Git repository URL (e.g., <code>github.com/myorg/my-app</code>) <code>branch</code> string No <code>main</code> Git branch to deploy <code>framework</code> enum Yes \u2014 <code>nextjs</code>, <code>rails</code>, <code>static</code>, or <code>docker</code> <code>environment</code> enum Yes \u2014 <code>staging</code>, <code>uat</code>, <code>production</code>, or <code>preview</code> <code>imageRef</code> string No \u2014 Container image reference (set by CI pipeline) <code>domain</code> string No Auto-generated Custom domain override <code>envVars</code> array No <code>[]</code> Additional environment variables <code>envVars[].name</code> string Yes \u2014 Variable name <code>envVars[].value</code> string No \u2014 Variable value (plain text) <code>envVars[].secretKeyRef</code> object No \u2014 Reference to a Secret key <code>cors</code> object No \u2014 CORS configuration <code>cors.origins</code> string[] No \u2014 Allowed origins <code>database</code> object No \u2014 Database configuration <code>database.enabled</code> boolean Yes \u2014 Enable PostgreSQL provisioning <code>database.schemaName</code> string No <code>name</code> (hyphens \u2192 underscores) PostgreSQL schema name <code>database.migrations.path</code> string No <code>./migrations</code> Migration files path <code>database.migrations.engine</code> enum No \u2014 <code>prisma</code>, <code>knex</code>, or <code>raw</code> <code>storage</code> object No \u2014 Object storage configuration <code>storage.enabled</code> boolean Yes \u2014 Enable S3 bucket provisioning <code>storage.buckets</code> array No <code>[]</code> Bucket definitions <code>storage.buckets[].name</code> string Yes \u2014 Bucket name <code>storage.buckets[].public</code> boolean No <code>false</code> Public read access <code>storage.buckets[].maxFileSize</code> string No \u2014 Max upload size <code>auth</code> object No \u2014 Authentication configuration <code>auth.enabled</code> boolean Yes \u2014 Enable Keycloak realm provisioning <code>auth.providers</code> string[] No <code>[]</code> Identity providers: <code>google</code>, <code>github</code>, <code>saml</code>, <code>oidc</code> <code>scaling</code> object No See defaults Autoscaling configuration <code>scaling.min</code> integer No <code>2</code> Minimum replicas <code>scaling.max</code> integer No <code>20</code> Maximum replicas <code>scaling.targetCPU</code> integer No <code>70</code> Target CPU utilization (%)"},{"location":"reference/crds/#status-fields","title":"Status Fields","text":"Field Type Description <code>phase</code> enum <code>Pending</code>, <code>Provisioning</code>, <code>Running</code>, <code>Failed</code>, or <code>Terminating</code> <code>url</code> string Public URL of the deployed application <code>conditions</code> array Detailed status of each subsystem <code>conditions[].type</code> enum <code>DatabaseReady</code>, <code>StorageReady</code>, <code>AuthReady</code>, <code>DeploymentReady</code>, <code>IngressReady</code> <code>conditions[].status</code> enum <code>\"True\"</code>, <code>\"False\"</code>, or <code>\"Unknown\"</code> <code>conditions[].reason</code> string Machine-readable reason for the condition <code>conditions[].message</code> string Human-readable description <code>conditions[].lastTransitionTime</code> string ISO 8601 timestamp of last status change"},{"location":"reference/crds/#phase-transitions","title":"Phase Transitions","text":"Phase Meaning <code>Pending</code> CR created, not yet processed <code>Provisioning</code> Operator is creating resources (database, storage, deployment) <code>Running</code> All conditions are <code>True</code>, app is serving traffic <code>Failed</code> A required resource could not be created (after retries) <code>Terminating</code> CR deleted, operator is cleaning up resources"},{"location":"reference/crds/#example","title":"Example","text":"<pre><code>apiVersion: platform.internal/v1alpha1\nkind: Application\nmetadata:\n  name: my-frontend\n  namespace: default\nspec:\n  repository: github.com/myorg/my-frontend\n  branch: main\n  framework: nextjs\n  environment: production\n  imageRef: 123456789.dkr.ecr.us-east-1.amazonaws.com/plattr-apps:my-frontend-abc123\n  database:\n    enabled: true\n    schemaName: my_frontend\n    migrations:\n      path: ./prisma/migrations\n      engine: prisma\n  storage:\n    enabled: true\n    buckets:\n      - name: uploads\n        public: false\n      - name: assets\n        public: true\n  auth:\n    enabled: true\n    providers:\n      - google\n      - github\n  scaling:\n    min: 2\n    max: 20\n    targetCPU: 70\n  domain: my-frontend.platform.company.dev\n</code></pre>"},{"location":"reference/crds/#kubernetes-resources-created","title":"Kubernetes Resources Created","text":"<p>When an Application is reconciled, the operator creates:</p> Resource Name Condition Secret <code>{name}-db</code> <code>database.enabled: true</code> ConfigMap <code>{name}-storage</code> <code>storage.enabled: true</code> ConfigMap <code>{name}-auth</code> <code>auth.enabled: true</code> ServiceAccount <code>{name}</code> Always Deployment <code>{name}</code> Always Service <code>{name}</code> Always Ingress <code>{name}</code> Always Ingress <code>{name}-api</code> <code>database.enabled: true</code> HPA <code>{name}</code> Always"},{"location":"reference/crds/#previewenvironment","title":"PreviewEnvironment","text":"<p>API Version: <code>platform.internal/v1alpha1</code> Kind: <code>PreviewEnvironment</code> Plural: <code>previewenvironments</code> Scope: Namespaced</p>"},{"location":"reference/crds/#spec-fields_1","title":"Spec Fields","text":"Field Type Required Default Description <code>applicationRef</code> string Yes \u2014 Name of the parent Application CR <code>pullRequest</code> integer Yes \u2014 Pull request number <code>branch</code> string Yes \u2014 Git branch name <code>ttl</code> string No <code>72h</code> Time to live before auto-cleanup. Format: <code>5m</code>, <code>2h</code>, <code>3d</code>, <code>72h</code>"},{"location":"reference/crds/#status-fields_1","title":"Status Fields","text":"Field Type Description <code>phase</code> enum <code>Pending</code>, <code>Provisioning</code>, <code>Running</code>, <code>Failed</code>, or <code>Terminating</code> <code>url</code> string Public URL of the preview environment <code>expiresAt</code> string ISO 8601 timestamp when the preview will be cleaned up"},{"location":"reference/crds/#example_1","title":"Example","text":"<pre><code>apiVersion: platform.internal/v1alpha1\nkind: PreviewEnvironment\nmetadata:\n  name: my-frontend-pr-42\n  namespace: default\nspec:\n  applicationRef: my-frontend\n  pullRequest: 42\n  branch: feature/new-login\n  ttl: 72h\n</code></pre>"},{"location":"reference/crds/#what-gets-created","title":"What Gets Created","text":"<p>For each PreviewEnvironment, the operator:</p> <ol> <li>Creates namespace <code>preview-{appName}-pr-{N}</code></li> <li>Provisions an isolated database schema (if parent app has <code>database.enabled</code>)</li> <li>Creates isolated S3 buckets (if parent app has <code>storage.enabled</code>)</li> <li>Deploys a workload with:</li> <li>Name: <code>{appName}-pr{N}</code></li> <li>Domain: <code>pr-{N}.{appName}.preview.{baseDomain}</code></li> <li>Scaling: min=1, max=2</li> <li>Full PostgREST sidecar (if database enabled)</li> <li>Sets <code>status.expiresAt</code> based on TTL</li> <li>Updates <code>status.url</code> with the preview URL</li> </ol>"},{"location":"reference/crds/#ttl-cleanup","title":"TTL Cleanup","text":"<p>The TTL controller runs every 5 minutes and deletes PreviewEnvironments where <code>status.expiresAt</code> has passed. Cleanup cascades:</p> <ol> <li>Delete workload resources (Deployment, Service, Ingress, HPA)</li> <li>Delete Keycloak realm (if auth enabled)</li> <li>Empty and delete S3 buckets (if storage enabled)</li> <li>Drop database schema and roles (if database enabled)</li> <li>Delete the namespace</li> </ol>"},{"location":"reference/crds/#installing-crds","title":"Installing CRDs","text":"<pre><code>kubectl apply -f manifests/crds/application.yaml\nkubectl apply -f manifests/crds/preview-environment.yaml\n</code></pre>"},{"location":"reference/crds/#verifying-crds","title":"Verifying CRDs","text":"<pre><code>kubectl get crd applications.platform.internal\nkubectl get crd previewenvironments.platform.internal\n\n# List all applications\nkubectl get apps -A\n\n# Describe an application\nkubectl describe app my-frontend\n</code></pre>"},{"location":"reference/plattr-yaml/","title":"<code>plattr.yaml</code> Reference","text":"<p>The <code>plattr.yaml</code> file defines your application's configuration. It lives in the root of your project and is read by the CLI (<code>plattr dev</code>, <code>plattr init</code>) and the Dagger pipeline.</p>"},{"location":"reference/plattr-yaml/#full-example","title":"Full Example","text":"<pre><code>name: my-app\nframework: nextjs\n\ndatabase:\n  enabled: true\n  schemaName: my_app\n  migrations:\n    path: ./prisma/migrations\n    engine: prisma\n\nstorage:\n  enabled: true\n  buckets:\n    - name: uploads\n      public: false\n    - name: assets\n      public: true\n\nauth:\n  enabled: true\n  providers:\n    - google\n    - github\n\nredis:\n  enabled: true\n\nsearch:\n  enabled: true\n\nscaling:\n  min: 2\n  max: 20\n  targetCPU: 70\n\nlocal:\n  port: 3000\n  env:\n    DEBUG: \"true\"\n    LOG_LEVEL: verbose\n</code></pre>"},{"location":"reference/plattr-yaml/#field-reference","title":"Field Reference","text":""},{"location":"reference/plattr-yaml/#top-level-fields","title":"Top-Level Fields","text":"Field Type Required Default Description <code>name</code> string Yes \u2014 App name. Lowercase alphanumeric and hyphens only. Must match <code>/^[a-z0-9]([a-z0-9-]*[a-z0-9])?$/</code>. <code>framework</code> string No Auto-detected One of: <code>nextjs</code>, <code>rails</code>, <code>static</code>, <code>docker</code>. Auto-detected from project files if not specified."},{"location":"reference/plattr-yaml/#database","title":"<code>database</code>","text":"Field Type Required Default Description <code>database.enabled</code> boolean Yes \u2014 Enable PostgreSQL database provisioning. <code>database.schemaName</code> string No <code>name</code> with hyphens replaced by underscores PostgreSQL schema name. Automatically environment-prefixed in production (e.g., <code>prod_my_app</code>). <code>database.migrations.path</code> string No <code>./migrations</code> Path to migration files, relative to project root. <code>database.migrations.engine</code> string No \u2014 Migration engine: <code>prisma</code>, <code>knex</code>, or <code>raw</code>."},{"location":"reference/plattr-yaml/#storage","title":"<code>storage</code>","text":"Field Type Required Default Description <code>storage.enabled</code> boolean Yes \u2014 Enable S3-compatible object storage. <code>storage.buckets</code> array No <code>[]</code> List of bucket definitions. <code>storage.buckets[].name</code> string Yes \u2014 Bucket name. Alphanumeric and hyphens. <code>storage.buckets[].public</code> boolean No <code>false</code> If <code>true</code>, objects are publicly readable."},{"location":"reference/plattr-yaml/#auth","title":"<code>auth</code>","text":"Field Type Required Default Description <code>auth.enabled</code> boolean Yes \u2014 Enable Keycloak authentication. <code>auth.providers</code> string[] No <code>[]</code> Identity providers to configure: <code>google</code>, <code>github</code>, <code>saml</code>, <code>oidc</code>."},{"location":"reference/plattr-yaml/#redis","title":"<code>redis</code>","text":"Field Type Required Default Description <code>redis.enabled</code> boolean Yes \u2014 Enable Redis cache. Locally runs Redis 7 in the Kind cluster."},{"location":"reference/plattr-yaml/#search","title":"<code>search</code>","text":"Field Type Required Default Description <code>search.enabled</code> boolean Yes \u2014 Enable OpenSearch. Locally runs OpenSearch 2.18 with Dashboards in the Kind cluster."},{"location":"reference/plattr-yaml/#scaling","title":"<code>scaling</code>","text":"<p>Controls the Horizontal Pod Autoscaler in production.</p> Field Type Required Default Description <code>scaling.min</code> number No <code>2</code> Minimum replica count. <code>scaling.max</code> number No <code>20</code> Maximum replica count. <code>scaling.targetCPU</code> number No <code>70</code> Target CPU utilization percentage for scaling."},{"location":"reference/plattr-yaml/#local","title":"<code>local</code>","text":"<p>Configuration for local development only. Has no effect in production.</p> Field Type Required Default Description <code>local.port</code> number No <code>3000</code> Port for the local dev server. <code>local.env</code> object No <code>{}</code> Additional environment variables injected during <code>plattr dev</code>. Keys are variable names, values are strings."},{"location":"reference/plattr-yaml/#minimal-examples","title":"Minimal Examples","text":""},{"location":"reference/plattr-yaml/#static-site-no-services","title":"Static Site (No Services)","text":"<pre><code>name: my-landing-page\nframework: static\n</code></pre>"},{"location":"reference/plattr-yaml/#api-with-database-only","title":"API with Database Only","text":"<pre><code>name: my-api\nframework: docker\n\ndatabase:\n  enabled: true\n</code></pre>"},{"location":"reference/plattr-yaml/#full-stack-app","title":"Full-Stack App","text":"<pre><code>name: my-saas\nframework: nextjs\n\ndatabase:\n  enabled: true\n  migrations:\n    engine: prisma\n\nstorage:\n  enabled: true\n  buckets:\n    - name: uploads\n      public: false\n\nauth:\n  enabled: true\n  providers:\n    - google\n    - github\n\nredis:\n  enabled: true\n\nsearch:\n  enabled: true\n</code></pre>"},{"location":"reference/plattr-yaml/#notes","title":"Notes","text":"<ul> <li>The <code>name</code> field is used to derive Kubernetes resource names, database schemas, S3 bucket prefixes, and DNS names. Choose it carefully \u2014 changing it later requires migration.</li> <li><code>framework</code> affects the build process (Dockerfile generation) and local dev server command. Use <code>docker</code> if your project has its own Dockerfile.</li> <li><code>scaling</code> is only used in production. Local dev always runs a single instance. Preview environments use <code>min: 1, max: 2</code>.</li> <li><code>database.schemaName</code> is rarely needed. The default (<code>name</code> with hyphens as underscores) works for most apps. Use this only if you need a specific schema name.</li> </ul>"}]}